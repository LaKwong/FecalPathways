---
title: "VO Longitudinal"
author: "Laura Kwong"
date: "2018-03-10"
output: html_document
---

Made for R version 3.3.3

Currently SO data is in the longitudinal analysis (tertiles, loess, linear trend lines, 
but NOT in the boxplots or tables because it lacks the specific dietary vs non-dietary hm and because it does not have complete location info. )

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, dpi = 800)
```

```{r}
# Coding notes

# Titles automatically became left-aligned. To center use  ... + theme(plot.title = element_text(hjust = 0.5))


# write.table(vo.hh.obs, file = "C:/Users/lenovo/Box Sync/VO R1/VO.hh.obs.csv", append = FALSE, quote = FALSE, sep = ",", row.names = FALSE,
#             eol = "\n", na = "NA", dec = ".", row.names = FALSE,
#             col.names = FALSE, qmethod = c("escape", "double"),
#             fileEncoding = "")


# # Try to make the plot with data.table
# Mean <- function(x) base::mean(x, na.rm=TRUE)
# SD <- function(x) base::sd(x, na.rm=TRUE)
# 
# test2 <- tabular((actobj + 1) ~ (n = 1) + Format(digits = 2) * (group3 + group4 + group5 + group6) * (Mean + SD),
#   data=test)
```


##### Analysis portion of VO123 analysis #########################

```{r}
library(fitdistrplus) 
# load fitdistrplus before tidyverse so dplyr's select overrides fidistrplus's select
library(viridis)
library(lme4)
library(ICC)
library(readxl)
library(xtable)
library(lubridate)
library(tidyverse)
# library(dunn.test)
# library(goftest)


# library(rJava)
# library(readxl)
# library(data.table)
# library(XLConnect)
# library(foreign)
# library(MASS)
# library(Hmisc)
# library(stringr)
# library(pastecs)
# library(psych)
# library(gdata)
# library(gtools)
# library(reshape)
# library(reshape2)
# library(chron)
# library(BAMMtools)
# library(irr)
# library(tables)

options(java.parameters = "-Xmx4096m ")
```


```{r params}
# Parameters
file_vo.9 <- "C:/Users/lenovo/Box Sync/VO R123/vo.9.analyze.csv"

file_dem.long <- "C:/Users/lenovo/Box Sync/VO R123/vo.dem.long.csv"

file_vo.awake <- "C:/Users/lenovo/Box Sync/VO R123/vo.awake.csv"

file_vo.awake.loc <- "C:/Users/lenovo/Box Sync/VO R123/vo.awake.loc.csv"

file_so.obs <- "C:/Users/lenovo/Dropbox/Fecal pathways/Structured obs/Analysis/SO_160310_submitted to IJERPH 160313/obs_analysis.csv"

file_so.dem <- "C:/Users/lenovo/Dropbox/Fecal pathways/Structured obs/Analysis/SO_160310_submitted to IJERPH 160313/dem_analysis.csv"

#file_SO.allObs <- "C:/Users/lenovo/Dropbox/Fecal pathways/Structured obs/Analysis/SO_160310_submitted to IJERPH 160313/dem_obs_full_freq.csv"


# Categories
Fields <- c("Soil","UrineSoil")
Fingers <- c("ChildHand","OtherHand","ChildHand_nd","ChildHand_d","OtherHand_nd","OtherHand_d")
Fomites <- c("PlantMaterial","Metal","Paper","Cloth","OtherObject","Plastic","Wood/Bricks","Utensil")
Foods <- c("Juice","Fruit","Bakery/Bread","PackagedFood","Rice/Khichuri","CookedVeg","RawVeg",
           "Breastmilk","Suji/Lota","DryFood","FoodWaste","Pickles","Dal","Fish/Meat/Egg",
           "Fuchka","DeepFried","IceCream","SpicedFruit","OtherFood")
Fluids <- c("TubewellWater","StoredWater","OtherWater")
Feces <- c("ChickenFeces","Goat/CowFeces","OtherAnimalFeces", "ChildsFeces","HumanFeces")
Animals <- c("Chicken", "Goat/Cow","OtherAnimal")

# Functions

'%notin%' <- function(x, y) { !(x %in% y)}

# Process obs dem data
process.obs.dem <- function(df) {
  df %>%
    filter(!is.na(obs.S)) %>%
    mutate(hh = as.factor(hh)) %>%
    select(hh, floor.hh, floor.courtyard, feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4,
           feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4) %>% # tothh, totppl, 
    group_by(hh, floor.hh, floor.courtyard) %>% # tothh, totppl, 
    mutate(#hh.dirt = floor.hh %in% c(5,6), courtyard.dirt = floor.courtyard %in% c(5,6),
      hh.childfeces = 1 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.humanfeces = 2 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.cowfeces = 3 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.goatfeces = 4 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.chickenfeces = 5 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.dogfeces = 6 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.nofeces = 7 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.childfeces = 1 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.humanfeces = 2 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.cowfeces = 3 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.goatfeces = 4 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.chickenfeces = 5 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.dogfeces = 6 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      hh.nofeces = 7 %in% c(feces.hh.type1, feces.hh.type2, feces.hh.type3, feces.hh.type4),
      courtyard.childfeces = 1 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.humanfeces = 2 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.cowfeces = 3 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.goatfeces = 4 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.chickenfeces = 5 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.dogfeces = 6 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.nofeces = 7 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.childfeces = 1 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.humanfeces = 2 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.cowfeces = 3 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.goatfeces = 4 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.chickenfeces = 5 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.dogfeces = 6 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4),
      courtyard.nofeces = 7 %in% 
        c(feces.courtyard.type1, feces.courtyard.type2, feces.courtyard.type3, feces.courtyard.type4)
    ) %>%
    group_by(hh, floor.hh, floor.courtyard) %>% # tothh, totppl, 
    summarise(
      human.feces.hh = sum(hh.childfeces, hh.humanfeces),
      human.feces.courtyard = 
        sum(courtyard.childfeces, courtyard.humanfeces),
      human.feces = 
        sum(hh.childfeces, hh.humanfeces, courtyard.childfeces, courtyard.humanfeces),
      animal.feces.hh = 
        sum(hh.cowfeces, hh.goatfeces, hh.chickenfeces, hh.dogfeces),
      animal.feces.courtyard = 
        sum(courtyard.cowfeces, courtyard.goatfeces, courtyard.chickenfeces, courtyard.dogfeces),
      animal.feces.numtype = 
        sum(hh.cowfeces, hh.goatfeces, hh.chickenfeces, hh.dogfeces,
            courtyard.cowfeces, courtyard.goatfeces, courtyard.chickenfeces, courtyard.dogfeces),
      animal.feces.any.hh = ifelse(animal.feces.hh > 0, 1, 0),
      animal.feces.any.courtyard = ifelse(animal.feces.courtyard > 0, 1, 0),
      animal.feces = as.numeric(animal.feces.hh > 0 | animal.feces.courtyard > 0),
      chicken.feces = as.numeric(hh.chickenfeces | courtyard.chickenfeces)
    ) %>%
    ungroup() 
}

# Function to test for trend by age
# Mixed effects model to account for the child being observed multiple times
freq.trend <- function(df, actobj.class.test) {
  # test <- 
  lmer(freq ~ age.mo + (1|hh), 
       # The model below makes (more?) sense but it more complicated and 
       # I don't have much data so I'll use the simplier model
       # freq ~ age.mo + loc + (1 + loc|hh)
       
       # age.mo is the fixed effect and hh is the random effect
       # (1|hh) means "assume an intercept that is different for each child"
       # "1" stands for the intercept
       # (1 + loc|hh) means "there are diff baseline levles (the intercetp)
       # and different responses to the main factor (loc) at baseline"
       # I think this makes sense because the behavior of the kids 
       # inside vs outside depends on what type of kids they are 
       # So a different slope and different intercept makes sense for hh.
       data = 
         df %>%
         filter(actobj.class == actobj.class.test)
  ) %>%
    summary()
}

freq.trend.mobility <- function(df, actobj.class.test) {
  lmer(freq ~ mobility + (1|hh), 
       data = 
         df %>%
         filter(actobj.class == actobj.class.test)
  ) %>%
    summary()
}

var2.sig.anova <- function(df, actobj.class.test, vars1, vars2) { #, var1, var2
  #vars <- quos(...) requires !!! but don't need here
  
  model <- 
    lmer(
      str_c("freq ~ ", vars1, "(1|hh)" ),
      # use str_c instead of freq ~ var1 + var2 + (1|hh)
      data = 
        df %>%
        filter(actobj.class == actobj.class.test),
      control = lmerControl(optimizer = "Nelder_Mead"),
      REML = FALSE
    )
  
  null <- 
    lmer(
      str_c("freq ~ ", vars2, "(1|hh)" ),
      # use str_c instead of freq ~ var1 + var2 + (1|hh)
      # null model must have same random effect structure as full model, 
      # so even if remove age.mo as a fixed effects for the null model, 
      # keep 1 + age.mo|hh in the fixed effects
      data = 
        df %>%
        filter(actobj.class == actobj.class.test),
      control = lmerControl(optimizer = "Nelder_Mead"),
      REML = FALSE
    )
  
  anova(null, model)
}






```

http://www.bodowinter.com/tutorial/bw_LME_tutorial2.pdf

To get the p-value for the mixed model, use the log likelihood
Likelihood  is the  probability  of  seeing  the  data  you  collected  given  your  model. The  logic  of  the  likelihood  ratio  test  is  to  compare  the  likelihood  of  two  models with  each  other.  First,  the  model withoutthefactor  that  you're  interested  in  (the null  model),  then  the  model withthe  factor  that  you're  interested
age.null <- freq.trend(vo.so, "Mouth_Hands", sex_t)
age.model <- freq.trend(vo.so, "Mouth_Hands", age.mo + sex_t)
anova(age.null, age.model)

citation()
citation("lme4")


```{r load data}
vo.9 <- 
  read_csv(file_vo.9) %>% #1294123
  select(-X, -X1) %>%
  rename(round = vo.num, age.mo = age.vo, age.group = age.vo.group) %>%
  mutate_at(vars(hh, round, age.group), funs(as.factor)) %>%
  arrange(hh, round)

vo.dem.long <- 
  read_csv(file_dem.long) %>%
  select(-X1) %>%
  rename(round = vo.num, age.mo = age.vo, age.group = age.vo.group) %>%
  mutate_at(vars(hh, round, sex_t), funs(as.factor))

vo.awake.loc <- 
  read_csv(file_vo.awake.loc) %>%
  select(-X1) %>%
  rename(round = vo.num) %>%
  mutate_at(vars(hh, round), funs(as.factor)) %>%
  arrange(hh, round)

so.dem.all.arms <- 
  read_csv(file_so.dem) %>%
  transmute(
    hh = as.factor(HH.participant_id),
    round = as.factor("so1"),
    arm,
    tothh,
    totppl,    
    sex_t = as.factor(sex_t),
    obs_date = dateR,
    birthdate = dob_tR,
    age.mo = as.integer(floor(age_SO)),
    age.group = age_SO_group,
    dom_hand = C.dom_hand,
    mobility = C.target_child_mobility,
    # change mobility sit = 3 to sit = 0
    mobility = ifelse(mobility == 3, 0, mobility),
    shirt = C.shirt,
    pants = C.pants,
    shoes = C.shoes,
    floor_hh = C.hh_floor,
    floor_courtyard = C.courtyard_floor,
    floor_feces_type = C.soil_feces_type,
    start = SE.start_obs,
    end = SE.end_obs,
    awake.hr = awake_duration,
    awake.in = in_awake,
    awake.out = out_awake,
    awake.dk = dk_awake
  ) %>%
  mutate_at(
    vars(awake.hr, awake.in, awake.out, awake.dk), 
    funs(if_else(is.na(.), 0, .))
  )

# so.dem <- so.dem.all.arms

so.dem <-
  so.dem.all.arms %>%
  filter(arm == "control")

# I used this dataframe containing all of the 150 structured observations to write files....150.csv to be analyzed later. I did not save this intermediate code. 

so.obs.150 <- 
  read_csv(file_so.obs) %>%
  rename(hh = participant_id) %>%
  mutate(hh = as.factor(hh)) %>%
  # # filter before for the hh in the vo, not just those in the control arm
  # # from SO_151205_used for IJERPH paper...line 316 arm == 3 is the control arm
  # filter(arm == 3) %>% 
  group_by(hh) %>%
  transmute(
    event_start = timeS * 24, # decimal hours since midnight
    event_end = lead(timeE2 * 24), # decimal hours since midnight
    # for the last event of each observation, need to fill in the end time 
    # of the event with the end time of the observation
    event_end = if_else(is.na(event_end), SE.end_obs * 24, event_end),
    event_dur = (event_end - event_start) * 60 * 60, # * 60 * 60 hour -> sec
    # ODK only captured time to the nearest minute, but keep in sec to match vo
    person, 
    object, 
    loc =  
      case_when(
        location == 0 ~ "DK",
        location == 1 ~ "Inside",
        location == 2 ~ "Outside",
        location == 3 ~ "All"# Doesn't exist yet
      ),
    Mouth_Hands = hand_mouth,
    Mouth_Cloth = cloth_mouth,
    Mouth_Toy = toy_mouth,
    Mouth_Fomites = Mouth_Cloth + Mouth_Toy,
    Mouth_Foods = food_mouth,
    Mouth_Water = water_mouth,
    Mouth_Animals = animal,
    Mouth_Soil = soil_mouth,
    Mouth_Feces = feces_mouth
  ) %>%
  gather(
    -hh, -event_start, -event_end, -event_dur, -person, -object, -loc,
    key = "actobj.class",
    value = "count"
  ) %>%
  replace_na(
    list(count = 0)
  )

# so.obs <- so.obs.150

# # not at all accurate to assume that if the duration of the event was 60 sec 
# # and the hand entered the mouth 5 times that each of the contacts was 12 sec
# # onds; perhaps shouldn't calculate at all so I am not tempted to use this 
# # value in analysis
# mutate(dur = event_dur/count)

so.obs <- 
  so.obs.150 %>%
  filter(hh %in% unique(vo.9$hh))

```

```{r}
########## Table 1 ################
# shirt: 1 = none, 2 = short-sleeved, 3 = long-sleeved 
# pants: 1 = none, 2 = underpants, 3 = shorts, 4 = long pants
# shoes (when outside): 1 = none, 2 = sandals, 3 = close-toed
# mobility: 1 = crawl, 2 = walk, 3 = sit --> recode so 0 = sit
# feces: 1 = child, 2 = other human, 3 = cow/buffalo, 4 = goat/sheep, 5 = chicken/duck/pigeon, 6 = dog/cat, 7 = no feces, 77 = other, 99 = could not observe
# floor: 1 = cement, 2 = tile, 3 = plastic, 4 = bamboo, 5 = dirt, 6 = mud, 77 = other, 99 = could not observed.  
# The enumerators only selected 1 for cement; and 6, which is coded as "mud" but I'm certain enough to say that they actually meant dirt that I will code it as dirt
# note: mobile = cell phone, mobility = sit/crawl/walk


################## Observational info ##########################
obs.stat <- 
  read.csv("C:/Users/lenovo/Box Sync/VO R123/obs.stat.csv") %>%
  mutate(hh = as.factor(hh), round = as.factor(vo.num)) %>%
  left_join(so.dem %>% transmute(hh = as.factor(hh), tothh, totppl), by = "hh")
## Add the number of TYPES of feces observed (animal.feces.courtyard = 3 means three TYPES of animal feces in the courtyard)

# obs.stat.floors <- left_join(obs.stat, SO.vohh %>% mutate(hh = as.factor(HH.participant_id)) %>% select(hh, hh_dirt, courtyard_dirt), by = "hh") %>%
#   mutate(floor.hh = hh_dirt, floor.courtyard = courtyard_dirt)

# Add feces data
# We didn't look for the presence of animals or animal feces in vo1
#obs.data1 <- loadWorkbook("C:/Users/lenovo/Box Sync/VO R1/Enrollment status/VO.R1 Status_final.xls")
#obs.stat.v1.raw <- readWorksheet(obs.data1, sheet = "obs.stat")

obs.stat.v2.raw <- 
  read_excel("C:/Users/lenovo/Box Sync/VO R2/Enrollment status/VO.R2 Status_final.xls", sheet = "obs.stat") # %>%
  # left_join(so.dem %>% transmute(hh = as.numeric(hh), tothh, totppl), by = "hh")
obs.stat.v3.raw <- 
  read_excel("C:/Users/lenovo/Box Sync/VO R3/Enrollment status/VO.R3 Status_final.xls", sheet = "obs.stat") # %>%
  # left_join(so.dem %>% transmute(hh = as.numeric(hh), tothh, totppl), by = "hh")

###### Round 2 hh survey data #######
obs.stat.v2.extra <- 
  obs.stat.v2.raw %>%
  mutate(round = as.factor("vo3")) %>%
  process.obs.dem() %>%
  mutate(
    round = "vo2", 
    dirt.hh = ifelse(floor.hh %in% c(5,6), 1, 0), 
    dirt.courtyard = ifelse(floor.courtyard %in% c(5,6), 1, 0)
  ) %>%
  select(
    hh, round, 
    # tothh, totppl, 
    dirt.hh, dirt.courtyard, human.feces, 
    animal.feces.any.hh, animal.feces.hh, 
    animal.feces.any.courtyard, animal.feces.courtyard, 
    animal.feces, chicken.feces
  )

###### Round 3 hh survey data #######
###### Round 2 hh survey data #######
obs.stat.v3.extra <- 
  obs.stat.v3.raw %>%
  mutate(round = as.factor("vo3")) %>%
  process.obs.dem() %>%
  mutate(
    round = "vo3", 
    dirt.hh = ifelse(floor.hh %in% c(5,6), 1, 0), 
    dirt.courtyard = ifelse(floor.courtyard %in% c(5,6), 1, 0)
  ) %>%
  select(
    hh, round, 
    # tothh, totppl, 
    dirt.hh, dirt.courtyard, human.feces, 
    animal.feces.any.hh, animal.feces.hh, 
    animal.feces.any.courtyard, animal.feces.courtyard, 
    animal.feces, chicken.feces
  )

obs.stat.v2v3.extra <- rbind(obs.stat.v2.extra, obs.stat.v3.extra)

obs.stat.full <- 
  left_join(obs.stat, obs.stat.v2v3.extra, by = c("hh", "round")) %>% # , "tothh", "totppl"
  left_join(vo.dem.long %>% select(hh, round, sex_t, age.mo), by = c("hh", "round")) %>%
  mutate(mobility = ifelse(mobility == 3, 0, mobility)) %>%
  select(
    hh, round, 
    #tothh, totppl, 
    sex_t, age.mo, mobility, shirt, pants, shoes, dom.hand, 
    dirt.hh, dirt.courtyard, 
    human.feces, animal.feces.any.hh, animal.feces.hh, 
    animal.feces.any.courtyard, animal.feces.courtyard, 
    animal.feces, chicken.feces
  )

#In the FP structured observation
# feces_type 1=target child, 2=other human, 3=cow/buffalo, 4=goat/sheep, 5=poultry, 6=dog/cat, 77=other, 99=could not obs
# I DID NOT HAVE AN OPTION FOR "No feces observed" so let 99=could not observe=DID NOT OBSERVE
# dem.so$C.soil_feces_type %notin% 
dem.so <- 
  so.dem %>% 
  mutate(
    round = "so1", 
    dom.hand = dom_hand,
    shoes = ifelse(shoes == 0, 1, 2),
    #dirt.hh = ifelse(floor.hh %in% c(5,6), 1, 0), dirt.courtyard = ifelse(floor.courtyard %in% c(5,6), 1, 0)) %>%
    dirt.hh = ifelse(floor_hh %in% c(5,6), 1, 0), 
    dirt.courtyard = ifelse(floor_courtyard %in% c(5,6), 1, 0),
    human.feces = ifelse(grepl(1, floor_feces_type), 1, 0), 
    animal.feces = ifelse(grepl(99, floor_feces_type), 0, 1),
    chicken.feces = ifelse(grepl(5, floor_feces_type), 1, 0)
  ) %>%
  # select(hh, round, kaccha, tin, electricity, table, chair, mobile, income6000, mother_edu, 
  #        tothh, totppl, numbari, numhh, sex_t, age.mo, mobility, shirt, pants, shoes, dom.hand, 
  #        dirt.hh, dirt.courtyard, human.feces, animal.feces, chicken.feces) %>%
  filter(hh %in% unique(obs.stat.full$hh)) %>%
  distinct(.keep_all = TRUE)

all.dem.data <- 
  plyr::rbind.fill(dem.so, obs.stat.full) %>%
  mutate_at(vars(round, hh), funs(as.factor))
```

# Make Paper Table 1
```{r}
T1 <- all.dem.data
# If there wasn't an observation (there is no start time), then set all the col except hh and round to NA
T1[is.na(T1$obs.S), -which(colnames(T1) %in% c("hh","round"))] <- NA

T1.results <- 
  T1 %>%
  filter(!is.na(mobility)) %>%
  group_by(round) %>%
  # could insert the animal feces observations from so1 into vo1 but then have to justify/explain so...don't 
  filter(round != "so1") %>%
  summarise(
    ageinmonths = mean(age.mo, na.rm = TRUE), 
    ageinmonths.sd = sd(age.mo, na.rm = TRUE), 
    ismale = mean(sex_t == 2, na.rm = TRUE), 
    sit = mean(mobility == 0, na.rm = TRUE), 
    crawl = mean(mobility == 1, na.rm = TRUE), 
    walk = mean(mobility == 2, na.rm = TRUE),
    noshirt = mean(shirt == 1, na.rm = TRUE), 
    nopants = mean(pants == 1, na.rm = TRUE), 
    noshoes = mean(shoes == 1, na.rm = TRUE),
    shortshirt = mean(shirt == 2, na.rm = TRUE), 
    longshirt = mean(shirt == 3, na.rm = TRUE),
    underpants = mean(pants == 2, na.rm = TRUE), 
    shorts = mean(pants == 3, na.rm = TRUE), 
    longpants = mean(pants == 4, na.rm = TRUE),
    nodom = mean(dom.hand == 1, na.rm = TRUE), 
    Rdom = mean(dom.hand == 2, na.rm = TRUE), 
    Ldom = mean(dom.hand == 3, na.rm = TRUE),
    human.feces = mean(human.feces, na.rm = TRUE), 
    animal.feces = mean(animal.feces, na.rm = TRUE), 
    chicken.feces = mean(chicken.feces, na.rm = TRUE),
    hh.floor.dirt = mean(dirt.hh == 1,  na.rm = TRUE), 
    courtyard.floor.dirt = mean(dirt.courtyard == 1, na.rm = TRUE)# ,
    # mother_edu = mean(mother_edu, na.rm = TRUE), 
    # cmpd.ppl = mean(totppl, na.rm = TRUE), 
    # cpmd.u5 = mean(numbari, na.rm = TRUE), 
    # hh.u5 = mean(tothh, na.rm = TRUE)
  )

T1.results.col <- t(T1.results) #transpose
row.names(T1.results.col) <- colnames(T1.results)
# write.csv(T1.results.col, "C:/Users/lenovo/Box Sync/VO R123/T1.results.col.csv")


############### Det how many children where in which age group during which obs round #################
# missing.vo2 "11403" "28605" "71105"
# missing.vo3 "58703" "58705" "71105"

obs.stat.full[obs.stat.full$hh == 11403 & obs.stat.full$round == "vo1", "age.mo"] #16 mo at vo1 -> would have been 28 mo (6) at vo2
obs.stat.full[obs.stat.full$hh == 28605 & obs.stat.full$round == "vo1", "age.mo"] #8 mo at vo1 -> would have been 20 mo (5) at vo2
obs.stat.full[obs.stat.full$hh == 71105 & obs.stat.full$round == "vo1", "age.mo"] #5 mo at vo1 -> would have been 17 mo (5) at vo2, 29 mo (6) at vo3
obs.stat.full[obs.stat.full$hh == 58703 & obs.stat.full$round == "vo1", "age.mo"] #6 mo at vo1 -> would have been 30 mo (6) at vo3
obs.stat.full[obs.stat.full$hh == 58705 & obs.stat.full$round == "vo1", "age.mo"] #6 mo at vo1 -> would have been 30 mo (6) at vo3
# hh_age.group that are missing
# 11403_6
# 28605_5
# 71105_5
# 71105_6
# 58703_6
# 58703_6

```

# Num of observations by round
```{r}
vo.dem.long %>%
  filter(is.na(age.group)) 
# There were 5 observations that did NOT occur of a scheduled 3 * 30 = 90
# I should have 85 observations...181019- but I think that vo2 was missing 3 so actually there were 84.... 

vo.dem.long %>%
  filter(!is.na(age.group)) %>% 
  # The children without an age group were not observed
  group_by(round, age.group) %>%
  count()

vo.num.age.group <-
  vo.dem.long %>%
  filter(!is.na(age.group)) %>% 
  # The children without an age group were not observed
  mutate(age.group = as.factor(age.group)) %>%
  group_by(age.group) %>%
  count()

# # Do not include SO because those results already published
# so.num.age.group <-
# so.dem %>%
#   filter(!is.na(age.group)) %>% 
#   # The children without an age group were not observed
#   mutate(age.group = as.factor(age.group)) %>%
#   group_by(age.group) %>%
#   count()
# 
# num.age.group <-
#   so.num.age.group %>%
#   full_join(vo.num.age.group, by = "age.group") %>%
#   mutate(num.children = sum(n.x, n.y, na.rm = TRUE))

```

# Prep structured observation data 
(paper 1 actobj.class FREQUENCIES ONLY all over again)
I assume that I already took out duplicates, as this is the dataset that I prepared for analysis

location NA=0=not recorded; 1=house, 2=courtyard, 3=latrine, 4=(there is no choice 4), 5=bush/field, 77=other
groups: location=1 -> inside (loc_group=1), location=2, 3, 5, or 77 -> outside (loc_group=2)

From SO_151205_used for IJERPH paper_... line 682
I made variables xxx_ptc = per time (conservative estimate) -> Ignore these.

```{r}
so.obs.loc <- # 149 unique hh -> good
    so.obs %>%
      group_by(hh, loc, actobj.class) %>%
      summarise(count = sum(count, na.rm = TRUE)) %>%
      ungroup() %>%
  spread(-hh, key = "loc" ) %>%
  group_by(hh, actobj.class) %>%
  mutate(
    All = sum(DK, Inside, Outside, na.rm = TRUE)
  ) %>%
  gather(-hh, -actobj.class, key = "loc", value = "count")
 
so.dem.loc.rec.h <-
    so.dem %>%
      select(hh, round, sex_t, age.mo, age.group, starts_with("awake")) %>%
      gather(
        -hh, -round, -sex_t, -age.mo, -age.group,
        key = "loc",
        value = "rec.h"
      ) %>%
      mutate(
        loc =
          case_when(
            loc == "awake.hr" ~ "All",
            loc == "awake.in" ~ "Inside",
            loc == "awake.out" ~ "Outside",
            loc == "awake.dk" ~ "DK"
          )
      )

df.so.all <-
  so.dem.loc.rec.h %>%
  left_join(
    so.obs.loc,
    by = c("hh", "loc")
  ) %>%
  mutate(
    freq = count / rec.h,
    dur.mean = NA # because we actually don't know how long the contact lasted
  ) %>%
  filter(count != 0) %>%
  select(
    hh,
    round,
    sex_t,
    age.mo,
    age.group,
    loc,
    actobj.class,
    count,
    rec.h,
    freq,
    dur.mean
  ) %>%
  ungroup() 

df.so <- 
  df.so.all %>%
  filter(loc == "All")
  
df.so %>%
  ungroup() %>%
  filter(actobj.class == "Mouth_Soil") %>%
  count(age.group)

# write_csv(df.so.all, "C:/Users/lenovo/Box Sync/VO R123/df.so.all.csv")
# write_csv(df.so, "C:/Users/lenovo/Box Sync/VO R123/df.so.csv")
# # write_csv(df.so.all, "C:/Users/lenovo/Box Sync/VO R123/df.so.all.150.csv")
# # write_csv(df.so, "C:/Users/lenovo/Box Sync/VO R123/df.so.150.csv")
```


# Prep video observation data
```{r}
df.vo.mouth.hands <-
  vo.9 %>%
  filter(actobj.class %in% c("Mouth_hands_d", "Mouth_hands_nd")) %>%
  group_by(round, hh, loc) %>%
  summarise(count = n(), dur.mean = mean(dur, na.rm = TRUE)) %>%
  ungroup() %>%
  transmute(round, hh, loc, actobj.class = "Mouth_Hands", count, dur.mean)

df.vo.touch.hands <-
  vo.9 %>%
  filter(actobj.class %in% c("Touch_hands_d", "Touch_hands_nd")) %>%
  group_by(round, hh, loc) %>%
  summarise(count = n(), dur.mean = mean(dur, na.rm = TRUE)) %>%
  ungroup() %>%
  transmute(round, hh, loc, actobj.class = "Touch_Hands", count, dur.mean)
```

```{r}
df.vo.base <-
  vo.9 %>%
  group_by(round, hh, loc, actobj.class) %>%
  summarise(count = n(), dur.mean = mean(dur, na.rm = TRUE)) %>%
  ungroup() %>%
  # add Mouth_Hands = Mouth_Hands_d + Mouth_Hands_nd
  bind_rows(df.vo.mouth.hands) %>%
  bind_rows(df.vo.touch.hands) %>%
  left_join(vo.awake.loc, by = c("round", "hh", "loc")) %>% # rec.h in vo.awake.loc is max of observed R or L hand inside and outside (max produced less error than mean)
  left_join(vo.dem.long, by = c("round", "hh")) %>%
  filter(
    actobj.class 
    %notin% 
      c(
        # # 14 June 2018 commented out the following so that I can work with Touch_hands_d and Touch_hands_nd in freq and dur -> hope this doesn't make a mess!
        # # I'll add Touch_hands = Touch_hands_d + Touch_hands_nd from df.vo.touch.hands
        # "Touch_hands_d",
        # "Touch_hands_nd",
        # I don't care about the following:
        "Mouth_Nothing", 
        "Mouth_NotInView", 
        "Touch_Nothing", 
        "Touch_NotInView", 
        "Touch_NA", 
        "NA_Nothing", 
        "NA_NA" 
      )
  ) %>%
  separate(
    actobj.class, 
    c("act", "obj.class"), 
    sep = "_", 
    extra = "merge", 
    fill = "right"
  ) %>%
  mutate(obj.class = str_to_title(obj.class)) %>%
  unite(actobj.class, c("act", "obj.class")) %>%
  select(hh, round, sex_t, age.mo, age.group, loc, actobj.class, count, rec.h, dur.mean) %>% # , freq) %>%
  ungroup() 

df.vo.all.count <- 
  df.vo.base %>%
  select(round, hh, sex_t, age.mo, age.group, actobj.class, loc, count) %>%
  spread(key = loc, value = count) %>%
  group_by(round, hh, sex_t, age.mo, age.group, actobj.class) %>%
  mutate(
    All = sum(Inside, Outside, na.rm = TRUE)
  ) %>%
  gather(-round, -hh, -sex_t, -age.mo, -age.group, -actobj.class, key = "loc", value = "count") %>%
  ungroup()

df.vo.all.dur <- 
  df.vo.base %>%
  select(round, hh, actobj.class, loc, dur.mean) %>%
  spread(key = loc, value = dur.mean) %>%
  group_by(round, hh, actobj.class) %>%
  mutate(
    All = sum(Inside, Outside, na.rm = TRUE)
  ) %>%
  gather(-round, -hh, -actobj.class, key = "loc", value = "dur.mean") %>%
  replace_na(list(dur.mean = 0)) %>%
  ungroup()

df.vo.all.rec.h <- 
  df.vo.base %>%
  select(round, hh, loc, rec.h) %>%
  distinct() %>%
  spread(key = loc, value = rec.h) %>%
  group_by(round, hh) %>%
  mutate(All = sum(Inside, Outside, na.rm = TRUE)) %>%
  gather(-round, -hh, key = "loc", value = "rec.h") %>%
  ungroup() 

df.vo.all <-
  df.vo.all.count %>% select(round, hh, sex_t, age.mo, age.group, loc, actobj.class, count) %>%
  left_join(df.vo.all.dur, by = c("round", "hh", "loc", "actobj.class")) %>%
  left_join(df.vo.all.rec.h, by = c("round", "hh", "loc")) %>%
  mutate(freq = count/rec.h) %>%
  select(names(df.so.all)) 

df.vo <-
  df.vo.all %>%
  filter(loc == "All")
# write_csv(df.vo.all, "C:/Users/lenovo/Box Sync/VO R123/df.vo.all.csv")
# write_csv(df.vo, "C:/Users/lenovo/Box Sync/VO R123/df.vo.csv")
```




# Combine structured and video observation data
(some children are in the same age group more than once)
```{r}  
mobility.all.obs <- 
  all.dem.data %>% 
  select(round, hh, mobility)
```

```{r}
vo.so.loc <-
  bind_rows(
    df.so.all %>%
      filter(loc != "All") %>%
      # Mouth_Cloth and Mouth_Toy are extra sub-categories that I made that we don't need because they are both included in Mouth_Fomite
      filter(actobj.class %notin% c("Mouth_Cloth", "Mouth_Toy"))
    ,
    df.vo.all %>%
    filter(loc != "All")
  ) %>%
  # Capitalize the names of the obj.class items 
  # (must take them apart and put them back together)
  separate(
    actobj.class, 
    c("act", "obj.class"), 
    sep = "_", 
    extra = "merge", 
    fill = "right"
  ) %>%
  mutate(obj.class = str_to_title(obj.class)) %>%
  unite(actobj.class, c("act", "obj.class"), remove = FALSE) %>%
  mutate_at(vars(age.group, loc, act, obj.class), funs(as.factor)) %>%
  mutate(
    act = ordered(act, levels = c("Mouth", "Touch")),
    obj.class =
      ordered(
        obj.class,
        levels = c(
          "Hands",
          "Hands_d",
          "Hands_nd",
          "Water",
          "Fomites",
          "Utensil",
          "Foods",
          "Soil",
          "Feces",
          "Animals"
        )
      ),
    actobj.class =
      ordered(
        actobj.class,
        levels = c(
          "Mouth_Hands",
          "Mouth_Hands_d",
          "Mouth_Hands_nd",
          "Mouth_Water",
          "Mouth_Fomites",
          "Mouth_Utensil",
          "Mouth_Foods",
          "Mouth_Soil",
          "Mouth_Feces",
          "Mouth_Animals",
          "Touch_Hands",
          "Touch_Hands_d",
          "Touch_Hands_nd",
          "Touch_Water",
          "Touch_Fomites",
          "Touch_Foods",
          "Touch_Soil",
          "Touch_Feces",
          "Touch_Animals"
        )
      )
  ) %>%
  left_join(mobility.all.obs, by = c("round", "hh")) %>%
  arrange(round, age.group, age.mo)

# write_csv(vo.so.loc, "C:/Users/lenovo/Box Sync/VO R123/vo.so.loc.csv")
# # write_csv(vo.so.loc, "C:/Users/lenovo/Box Sync/VO R123/vo.so.loc.150.csv")

vo.so.loc %>%
  group_by(age.group, actobj.class, loc) %>%
  filter(round != "so1", act == "Mouth") %>%
  summarise_at(vars(freq), funs(mean, sd, median, min, max), na.rm = TRUE) %>%
  arrange(age.group, loc, actobj.class)
```


## Number of kids in each age group for all SO and VO data
WITHOUT TAKING AVERAGE OF DUPS for all the SO and VO data
This is the actual number of children observed

# Divided by age group only (not loc)
Using the vo.so.loc data
```{r}
# # I MADE A HUGE MISTAKE IN THE PAPER THAT I PUBLISHED!! I ADDED FRACTIONS, WHICH YOU CAN'T DO. 
# # Should have done the following
vo.so <-
  rbind(df.so, df.vo)

# write_csv(vo.so, "C:/Users/lenovo/Box Sync/VO R123/vo.so.csv")
# # write_csv(vo.so, "C:/Users/lenovo/Box Sync/VO R123/vo.so.150.csv")
```

# HM and OM differences between frequencies in SO and VO for children OF THE SAME AGE GROUP? 
```{r}
vo.so %>%
  distinct(round, hh, .keep_all = TRUE) %>%
  mutate(round2 = ifelse(round %in% c("vo1", "vo2", "vo3"), "vo", "so")) %>% # 
  group_by(age.group, round2) %>%
  count()

# compare children in age group == 3 for Mouth_Hands, p = 0.4286
ks.test(
  vo.so %>% filter(round %in% c("so1"), age.group == 3, actobj.class == "Mouth_Hands") %>% pull(freq), # count() = 6
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), age.group == 3, actobj.class == "Mouth_Hands") %>% pull(freq) # count() = 2
)

# compare children in age group == 3 for Mouth_Fomites, p = 0.09524
ks.test(
  vo.so %>% filter(round %in% c("so1"), age.group == 3, actobj.class == "Mouth_Fomites") %>% pull(freq), # count() = 6
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), age.group == 3, actobj.class == "Mouth_Fomites") %>% pull(freq) # count() = 2
)

# compare children in age group == 4 for Mouth_Hands, p = 0.9781
ks.test(
  vo.so %>% filter(round %in% c("so1"), age.group == 4, actobj.class == "Mouth_Hands") %>% pull(freq), # count() = 19
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), age.group == 4, actobj.class == "Mouth_Hands") %>% pull(freq) # count() = 19
)

# compare children in age group == 4 for Mouth_Fomites, p = 0.06809
ks.test(
  vo.so %>% filter(round %in% c("so1"), age.group == 4, actobj.class == "Mouth_Fomites") %>% pull(freq), # count() = 19
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), age.group == 4, actobj.class == "Mouth_Fomites") %>% pull(freq) # count() = 19
)

# compare children in age group == 5 for Mouth_Hands, p = 0.1199
ks.test(
  vo.so %>% filter(round %in% c("so1"), age.group == 5, actobj.class == "Mouth_Hands") %>% pull(freq), # count() = 5
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), age.group == 5, actobj.class == "Mouth_Hands") %>% pull(freq) # count() = 31
)

# compare children in age group == 5 for Mouth_Fomites, p = 0.01423
ks.test(
  vo.so %>% filter(round %in% c("so1"), age.group == 5, actobj.class == "Mouth_Fomites") %>% pull(freq), # count() = 5
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), age.group == 5, actobj.class == "Mouth_Fomites") %>% pull(freq) # count() = 31
) 
# There are substantially higher object-mouthing frequencies of children in the same age group in the VO compared to the SO so these should NOT be compared to assess trends. 

# There were 0 children in age group == 6 in the SO so can't compare this to the VO. 


```

# HM and OM differences between frequencies in SO and VO for children OF THE SAME MOBILITY? 
```{r}
vo.so %>%
  distinct(round, hh, .keep_all = TRUE) %>%
  mutate(round2 = ifelse(round %in% c("vo1", "vo2", "vo3"), "vo", "so")) %>%
  group_by(mobility, round2) %>%
  count()

# There were 0 children of mobility == 0 in the VO so can't compare this to the SO. 

# compare children in mobility == 1 for Mouth_Hands, p = 0.4802
ks.test(
  vo.so %>% filter(round %in% c("so1"), mobility == 1, actobj.class == "Mouth_Hands") %>% pull(freq), # count() = 11
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), mobility == 1, actobj.class == "Mouth_Hands") %>% pull(freq) # count() = 16
)

# compare children in mobility == 1 for Mouth_Fomites, p = 0.0006638
ks.test(
  vo.so %>% filter(round %in% c("so1"), mobility == 1, actobj.class == "Mouth_Fomites") %>% pull(freq), # count() = 11
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), mobility == 1, actobj.class == "Mouth_Fomites") %>% pull(freq) # count() = 16
)
# There are substantially higher object-mouthing frequencies of children in the same age group in the VO compared to the SO so these should NOT be compared to assess trends. 

# compare children in mobility == 2 for Mouth_Hands, p = 0.867
ks.test(
  vo.so %>% filter(round %in% c("so1"), mobility == 2, actobj.class == "Mouth_Hands") %>% pull(freq), # count() = 3
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), mobility == 2, actobj.class == "Mouth_Hands") %>% pull(freq) # count() = 68
)

# compare children in mobility == 2 for Mouth_Fomites, p = 0.1042
ks.test(
  vo.so %>% filter(round %in% c("so1"), mobility == 2, actobj.class == "Mouth_Fomites") %>% pull(freq), # count() = 3
  vo.so %>% filter(round %in% c("vo1", "vo2", "vo3"), mobility == 2, actobj.class == "Mouth_Fomites") %>% pull(freq) # count() = 68
)
# There are substantially higher object-mouthing frequencies of children in the same age group in the VO compared to the SO so these should NOT be compared to assess trends. 
```









#### FROM HERE ON, USE VO DATA ONLY FOR ALL ANALYSIS ##########
```{r}
vo.loc <-
  df.vo %>%
  ungroup() %>%
  # Capitalize the names of the obj.class items 
  # (must take them apart and put them back together)
  separate(
    actobj.class, 
    c("act", "obj.class"), 
    sep = "_", 
    extra = "merge", 
    fill = "right"
  ) %>%
  mutate(obj.class = str_to_title(obj.class)) %>%
  unite(actobj.class, c("act", "obj.class"), remove = FALSE) %>%
  mutate_at(vars(round, hh, age.group, loc, act, obj.class), funs(as.factor)) %>%
  mutate(
    act = ordered(act, levels = c("Mouth", "Touch")),
    obj.class =
      ordered(
        obj.class,
        levels = c(
          "Hands",
          "Hands_d",
          "Hands_nd",
          "Water",
          "Fomites",
          "Utensil",
          "Foods",
          "Soil",
          "Feces",
          "Animals"
        )
      ),
    actobj.class =
      ordered(
        actobj.class,
        levels = c(
          "Mouth_Hands",
          "Mouth_Hands_d",
          "Mouth_Hands_nd",
          "Mouth_Water",
          "Mouth_Fomites",
          "Mouth_Utensil",
          "Mouth_Foods",
          "Mouth_Soil",
          "Mouth_Feces",
          "Mouth_Animals",
          "Touch_Hands_d",
          "Touch_Hands_nd",
          "Touch_Water",
          "Touch_Fomites",
          "Touch_Foods",
          "Touch_Soil",
          "Touch_Feces",
          "Touch_Animals"
        )
      )
  ) %>%
  left_join(mobility.all.obs, by = c("round", "hh")) %>%
  mutate_at(vars(round, hh, age.group, loc, act, obj.class), funs(as.factor))

# write_csv(vo.loc, "C:/Users/lenovo/Box Sync/VO R123/vo.loc.csv")
```

# Divided by age group only (not loc)
Using the vo.locdata
```{r}
vo <- 
  vo.loc %>%
  ungroup() %>%
  # mutate(dur.mean = if_else(is.na(dur.mean), 1, dur.mean)) %>%
  group_by(round, hh, sex_t, mobility, age.mo, age.group, actobj.class, act, obj.class) %>%
  summarise(
    freq = sum(freq, na.rm = TRUE), # ADD THE FREQ IN DIFF LOC TO GET TOT FREQ
    # 29 March 2019 .... you can't do this. You can't add frequencies to get an overall frequency. Instead you have to add the counts then divide by the total number of hours. Not sure what to do now, since this is already published. ...Sigh. No wonder your frequencies for both locations combined were so high. Although you reported indoor and outdoor separately and there wasn't a sig difference between either of those and all (which is why you weren't going to report them separately until the reviewer asked). I'm not going to recalculate here but instead let sleeping dogs lie. Arg. Integrity. 
    dur = mean(dur.mean, na.rm = FALSE)
  ) %>%
  ungroup() %>%
  mutate(hh = as_factor(hh))

# write_csv(vo, "C:/Users/lenovo/Box Sync/VO R123/vo.csv")
```

### How many children were observed? For Mouth_hand and Mouth_fomite
```{r}
vo %>%
  distinct(hh, age.mo, .keep_all = TRUE) %>%
  arrange(hh) %>%
  count(age.group)

vo %>%
  distinct(hh, age.group, .keep_all = TRUE) %>%
  arrange(hh) %>%
  count(age.group)
```

WITH DUPLICATES INCLUDED

* For mouthing of hands dietary and non-dietary (captured only on video):
3 (2 kids), 4 (19 kids), 5 (31 kids), 6 (26 kids), 7 (6 kids)


IF I REMOVE DUPLICATES

* For mouthing of hands dietary and non-dietary (captured only on video):
3 (2 kids), 4 (19 kids), 5 (28 kids), 6 (26 kids), 7 (6 kids)


# Time spent inside vs outside
```{r time.outside, results="asis"}
# Results for the two children age.group == 3. The reviewer's asked about their mean percent time outdoors being very high. 
vo.loc %>%
  select(round, hh, age.group, age.mo, loc, rec.h) %>%
  filter(age.group == 3) %>%
  distinct() %>%
  spread(key = "loc", value = rec.h) %>%
  replace_na(list("Inside" = 0, "Outside" = 0), 0) %>%
  group_by(age.group) %>%
  mutate(count = n()) %>%
  group_by(age.group, count) %>%
  mutate(
    all.time = Inside + Outside,
    pc.indoor = Inside / all.time,
    pc.outdoor = Outside / all.time 
  )

vo.time.loc <- 
  vo.loc %>%
  select(round, hh, age.group, age.mo, loc, rec.h) %>%
  distinct() %>%
  spread(key = "loc", value = rec.h) %>%
  replace_na(list("Inside" = 0, "Outside" = 0), 0) %>%
  group_by(age.group) %>%
  mutate(count = n()) %>%
  group_by(age.group, count) %>%
  mutate(
    all.time = Inside + Outside,
    pc.indoor = Inside / all.time,
    pc.outdoor = Outside / all.time 
  ) %>%
  summarise_at(vars(age.mo, all.time, pc.indoor, pc.outdoor), funs(mean)) # min, median, max

tab <- xtable(vo.time.loc)
print(tab, type = "html")
```

Calc the fraction of time indoors for each observation ->
Mean % indoors is 37-52% for all age groups (children <6 mo spent the LEAST % of time indoors - maybe because during napping and breastfeeding they were indoors so when they were observed they were outdoors)?

# Average duration of observation
```{r}
vo.loc %>%
  select(round, hh, age.group, age.mo, loc, rec.h) %>%
  distinct() %>%
  spread(key = "loc", value = rec.h) %>%
  replace_na(list("Inside" = 0, "Outside" = 0), 0) %>%
  mutate(
    all.time = Inside + Outside,
    pc.indoor = Inside / all.time,
    pc.outdoor = Outside / all.time 
  ) %>%
  summarise_at(vars(age.mo, all.time, Inside, Outside, pc.indoor, pc.outdoor), funs(mean)) # min, median, max
```
Observations averaged 3.808 hours = 3 hr and 48 min for a total of 319 observed hours (video only) 
Good - 84 children * 3.808 hr/child = 319 hr



# Which day of the week did observation occur?
```{r}
# so.weekdays <-
#   so.dem %>% 
#   mutate(weekday = weekdays(obs_date)) %>%
#   distinct(round, hh, weekday) %>%
#   count(weekday)

vo.weekdays <- 
  vo.9 %>% 
  mutate(weekday = weekdays(clip.S)) %>%
  distinct(round, hh, weekday) %>%
  count(weekday)

# rbind(so.weekdays, vo.weekdays) %>%
#   group_by(weekday) %>%
#   summarize(n = sum(n))
```

Wed had the fewest (8) obs and Sat had the most (16)

# Make a table of the frequencies
```{r}
mouthing_touching_hands_obj_age.group_freq <-
  vo %>% # already summed by location
  filter(
    obj.class %in% 
      c(
        "Hands", "Hands_d", "Hands_nd", "Fomites")
  ) %>%
  # filter(
  #   actobj.class %in% 
  #     c(
  #       "Mouth_Hands", "Mouth_Hands_d", "Mouth_Hands_nd", "Mouth_Fomites")
  # ) %>%
  group_by(age.group, act, obj.class) %>%
  summarise_at(vars(freq), funs(mean, median, min, max)) %>%
  mutate_if(is.numeric, funs(round), digits = 1) %>%
  arrange(act, age.group, obj.class)

write.csv(mouthing_touching_hands_obj_age.group_freq, "C:/Users/lenovo/Box Sync/VO R123/mouthing_touching_hands_obj_age.group_freq.csv")
```

These are really high mouthing frequencies! If an average contact is 5 seconds, then a child who puts the hand in the mouth 100 times/hr has the hand in the mouth for 500 s = 500/60 = > 8 minutes of the entire hour!

```{r}
vo %>%
  filter(act == "Mouth") %>%
  arrange(desc(freq))
```


For 10-month-old hh 20801: Mouth_Hands at 647 times/hr, Mouth_hands_d 635 times/hr, Mouth_Foods 619 times/hr, 
19-month-old hh 55705: Mouth_foods 343 times/hr,
41-month-old hh 4801: Mouth_Hands 298 times/hr, Mouth_Hands_d 287 times/hr, Mouth_Foods 289 times/hr

## Mouthing freq graph with trendline
```{r, fig.width=12}
vo.hands.obj.summary <-
  vo %>%
  filter(
    actobj.class %in% 
      c("Mouth_Hands", "Mouth_Hands_nd", "Mouth_Hands_d", "Mouth_Fomites")
  ) %>%
  mutate(
    actobj.class = 
      ordered(
        actobj.class,
        labels = 
          c(
            "Hands\nall", 
            "Hands\nwhile eating", 
            "Hands\nwhile not eating", 
            "Objects"
          )
      ),
    mobility = 
      ordered(
        mobility,
        levels = c(0, 1, 2), 
        labels = c("Immobile", "Crawling", "Walking")
      )
  ) 

vo.hands.obj.summary %>%
  ggplot(aes(age.mo, freq)) + 
  geom_point(aes(color = age.group, shape = fct_rev(mobility))) + # aes(color = hh)
  # geom_smooth(method = "lm") + 
  scale_color_hue(
    # name = "Age group",
    # breaks =
    #   c(3, 4, 5, 6, 7),
    labels =
      c(
        "3-5 months (n = 2)",
        # (n = 2 for hand mouthingrelated to eating or not)
        "6-11 months (n = 19*)",
        # (n = 19 for hand mouthing related to eating or not)
        "12-23 months (n = 31)", 
        # (n = 31 for hand mouthing related to eating or not)
        "24-35 months (n = 26)",
        "36-47 months (n = 6)"
        
        #         "\n3-5 months\n(n = 8*)",
        #   # (n = 2 for hand mouthingrelated to eating or not)
        #         "\n6-11 months\n(n = 37*)",
        # # (n = 19 for hand mouthing related to eating or not)
        #         "\n12-23 months\n(n = 36*)", 
        # # (n = 31 for hand mouthing related to eating or not)
        #         "\n24-35 months\n(n = 26)",
        #         "\n36-47 months\n(n = 6)"
      )
  ) +
  scale_shape_manual(
    breaks = c("Walking", "Crawling", "Immobile"),
    labels = c("Walking", "Crawling", "Immobile"),
    values = c(10, 4, 1)
  ) +
  labs(
    # title = "Frequency of mouthing hands and objects",
    caption = 
      "* Fewer datapoints are availabe for disaggregated hand mouthing categories,
Not shown: 
10-month-old child with hand mouthing 647 times/hr and food-related hand mouthing 635 times/hr,
41-month-old child with hand mouthing 298 times/hr and food-related hand mouthing 287 times/hr",

x = "Age in months",
y = "Mouthing freqency (contacts/hr)",
color = "Age group",
shape = "Mobility"
  ) +
  theme_bw() +  
  # theme(
  #   legend.position = "none"
  # ) +
  theme(
    legend.position = "right",
    # legend.position = c(0.99, 0.99),
    # legend.justification = c(1, 1),
    # legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
    # text = element_text(size = 8),
    legend.text = element_text(size = 9),
    plot.caption = element_text(size = 8, hjust = 0, margin = margin(t = 15))
  ) +
  guides(
    color = guide_legend(order = 1),
    shape = guide_legend(order = 2, reverse = TRUE)
  ) + 
  coord_cartesian(ylim = c(0, 300)) +
  facet_grid(~actobj.class) # , switch = "x"

ggsave(
  filename = "mouthing.linear.legend.right.png", 
  path = "C:/Users/lenovo/Box Sync/VO R123/",
  device = "png", 
  scale = 1.5,
  width = 6.5, 
  height = 4,
  units = "in",
  dpi = 1000
)
```

This graph omits  
For 10-month-old hh 20801: Mouth_Hands at 647 times/hr, Mouth_hands_d 635 times/hr, Mouth_Foods 619 times/hr - ate lychee and chips throughout the observation. 
Also 41-month-old hh 4801: Mouth_Hands 298 times/hr, Mouth_Hands_d 287 times/hr, Mouth_Foods 289 times/hr


## Boxplot of Mouthing
```{r, fig.width=12}
vo %>%
  filter(
    actobj.class %in% 
      c("Mouth_Hands", "Mouth_Hands_nd", "Mouth_Hands_d", "Mouth_Fomites")
  ) %>%
  mutate(
    actobj.class = 
      ordered(
        actobj.class,
        labels = 
          c(
            "Hands\nall", 
            "Hands\nduring feeding", 
            "Hands\nnot during feeding", 
            "Objects"
          )
      ) 
  ) %>%
  ggplot(aes(age.group, freq, color = age.group)) +
  geom_boxplot(width = 1, outlier.shape = NA) + # varwidth = TRUE,  
  geom_jitter(width = 0.2, alpha = 0.4) +
  
  # * For mouthing of hands dietary and non-dietary (captured only on video):
  # 3 (2 kids), 4 (19 kids), 5 (31 kids), 6 (26 kids), 7 (6 kids)
  
  scale_color_hue(
    name = "Age group",
    # breaks =
    #   c(3, 4, 5, 6, 7),
    labels =
      c(
        "3-5 months (n = 2)",
"6-11 months (n = 19)",
"12-23 months (n = 31)",
"24-35 months (n = 26)",
"36-47 months (n = 6)"
      )
  ) +
  # scale_color_viridis(
  #   discrete = TRUE,
  #   option = "C",
  #   name = "Age group",
  #   # breaks =
  #   #   c(3, 4, 5, 6, 7),
  #   labels =
  #     c(
  #       "3-5 months (n = 8)",
  #       "6-11 months (n = 38)",
  #       "12-23 months (n = 28)",
#       "24-35 months (n = 26)",
#       "36-47 months (n = 6)"
#       )
# ) +
labs(
  title = "Frequency of Mouthing Hands and Objects, by Age Group", 
  y = "Frequency (contacts / hr)"
) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 16),
    strip.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 16),
    axis.title.y = element_text(size = 16),
    axis.text.x = element_blank(),
    axis.ticks.length = unit(0, "cm"),
    axis.title.x = element_blank(),
    legend.position = "right",
    # legend.background = element_rect(fill = "white"),
    # legend.position = c(1, 0.99), # c(0.01, 0.99),
    # legend.justification = c(1, 1), # c(0, 1)
    legend.title = element_text(size = 8),
    legend.text = element_text(size = 8)
  ) +
  coord_cartesian(ylim = c(0, 350)) +
  facet_grid(. ~ actobj.class) # , switch = "x"

ggsave(
  filename = "mouthing.freq.boxplot.legend.right.png", 
  path = "C:/Users/lenovo/Box Sync/VO R123/",
  device = "png", 
  scale = 1.5,
  width = 6.5, 
  height = 4,
  units = "in",
  dpi = 1000
)
```

This graph omits one child age group 4 (10-months-old) who mouthed hands 647 times/hr as he ate lychee and chips throughout the observation. 























## Weibull plot - Didn't use this. 
Used R Mouthing/VO Longitudinal_Weibull plot function/Weibull.plot function_180321.R instead
```{r, eval=FALSE}
ages <- c(3, 4, 5, 6, 7)
locs <- c("Inside", "Outside")
actobjs <- c("Mouth_Hands", "Mouth_Hands_nd", "Mouth_Hands_d", "Mouth_Fomites")

# weib.data <- expand.grid(age = ages, location = locs, actobj = actobjs)
# weib.data.ages <- list(weib.data$age)
# weib.data.locs <- list(weib.data$location)
# weib.data.actobjs <- list(weib.data$actobj)
# 
# find.weib <- function(age, location, actobj){
#     vo %>%
#     filter(age.group == age, loc == location, actobj.class == actobj) %>%
#     pull(freq) %>%
#     fitdist(distr = "weibull") %>%
#     coef()
# }
# 
# pmap(list(age = weib.data$age, location = weib.data$location, actobj = weib.data$actobj), ~ find.weib(age, location, actobj))
# pmap(list(age = weib.data.ages, location = weib.data.locs, actobj = weib.data.actobjs), ~ find.weib(age, location, actobj))
# pmap(list(weib.data.ages, weib.data.locs, weib.data.actobjs), ~ find.weib(age, location, actobj))

find.weib.inside.MH <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Inside", actobj.class == "Mouth_Hands") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.outside.MH <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Outside", actobj.class == "Mouth_Hands") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.inside.MH_nd <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Inside", actobj.class == "Mouth_Hands_nd") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.outside.MH_nd <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Outside", actobj.class == "Mouth_Hands_nd") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.inside.MH_d <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Inside", actobj.class == "Mouth_Hands_d") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.outside.MH_d <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Outside", actobj.class == "Mouth_Hands_d") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.inside.MF <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Inside", actobj.class == "Mouth_Fomites") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef()
}

find.weib.outside.MF <- function(age){
  vo.loc %>% 
    filter(age.group == age, loc == "Outside", actobj.class == "Mouth_Fomites") %>% 
    pull(freq) %>% 
    fitdist(distr = "weibull") %>%
    coef() # %>%
  # cbind(loc = rep("Outside", 2)) %>%
  # cbind(actobj.class = rep("Mouth_Fomites", 2))
  
}

weib.inside.MH <-
  ages %>%
  map(~ find.weib.inside.MH(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c(3, 3, 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Hands",
    param = rep(c("shape", "scale"), 5),
    loc = rep("Inside", 10),
    study = rep("Bangladesh", 10)
  )

weib.outside.MH <-
  ages %>%
  map(~ find.weib.outside.MH(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c(3, 3, 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Hands",
    param = rep(c("shape", "scale"), 5),
    loc = rep("Outside", 10),
    study = rep("Bangladesh", 10)
  )

weib.inside.MH_nd <-
  ages %>%
  map(~ find.weib.inside.MH_nd(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c(3, 3, 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Hands_nd",
    param = rep(c("shape", "scale"), 5),
    loc = rep("Inside", 10),
    study = rep("Bangladesh", 10)
  )
weib.outside.MH_nd <-
  ages %>%
  map(~ find.weib.outside.MH_nd(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c(3, 3, 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Hands_nd",
    param = rep(c("shape", "scale"), 5),
    loc = rep("Outside", 10),
    study = rep("Bangladesh", 10)
  )

# No data for age group = 3
weib.inside.MH_d <-
  c(4, 5, 6, 7) %>%
  map(~ find.weib.inside.MH_d(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c( 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Hands_d",
    param = rep(c("shape", "scale"), 4),
    loc = rep("Inside", 8),
    study = rep("Bangladesh", 8)
  )


# No data for age group = 3
weib.outside.MH_d <-
  c(4, 5, 6, 7) %>%
  map(~ find.weib.outside.MH_d(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c( 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Hands_d",
    param = rep(c("shape", "scale"), 4),
    loc = rep("Outside", 8),
    study = rep("Bangladesh", 8)
  )

weib.inside.MF <-
  ages %>%
  map(~ find.weib.inside.MF(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c(3, 3, 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Fomites",
    param = rep(c("shape", "scale"), 5),
    loc = rep("Inside", 10),
    study = rep("Bangladesh", 10)
  )

weib.outside.MF <-
  ages %>%
  map(~ find.weib.outside.MF(.)) %>%
  unlist() %>%
  as_tibble() %>%
  mutate(
    age = c(3, 3, 4, 4, 5, 5, 6, 6, 7, 7),
    actobj.class = "Mouth_Fomites",
    param = rep(c("shape", "scale"), 5),
    loc = rep("Outside", 10),
    study = rep("Bangladesh", 10)
  )

# Add the Xue data to fitdata
############# Hands ###########
# Xue hand mouthing 3-6 mo (age.group = 3): 
# indoor (n = 23) median=23.0, scale 30.19, shape 1.28; 
# outdoor (n = NA) median=na
# Xue hand mouthing 6-12 mo (age.group = 4): 
# indoor (n = 119) median=14.0, scale=19.01, shape=1.02; 
# outdoor (n = 10) median=11.6, scale=15.98, shape=1.39
# Xue hand mouthing 12-24 mo (age.group = 5): 
# indoor (n = 245) median=14.0, scale=18.79, shape=0.91; 
# outdoor (n=32) median=8.0, scale=13.76, shape=0.98
# Xue hand mouthing 24-36 mo (age.group = 6): 
# indoor (n = 161) median=9.0, scale=11.04, shape=0.76; 
# outdoor (n = 46) median=2.6, scale=3.41, shape=0.56
# Xue hand mouthing 36-72 mo (age.group = 7): 
# indoor (n=169) median=9.0 , scale=12.59, shape=0.75; 
# outdoor (n=55), median=5.6, scale=5.53, shape=0.55

######### Objects ##############
# Xue object mouthing 3-6 mo (age.group = 3): 
# indoor (n = 19) median=9.30,scale=9.83, shape=0.74;  
# outdoor (n = NA) median=na
# Xue object mouthing 6-12 mo (age.group = 4): 
# indoor (n = 82) median=19.0, scale=22.72, shape=1.66; 
# outdoor (n = NA) median=na
# Xue object mouthing 12-24 mo (age.group = 5): 
# indoor (n = 137) median=12.3, scale=15.54, shape=1.39 ; 
# outdoor (n = 21) median=6.0, scale=8.58,shape=0.93
# Xue object mouthing 24-36 mo (age.group = 6): 
# indoor (n = 95) median=8.70, scale=10.75, shape=1.36; 
# outdoor (n = 29) median=4.6, scale=6.15, shape=0.64
# Xue object mouthing 36-72 mo (age.group = 7): 
# indoor (n=14) median=5.0 , scale=6.9, shape=0.85; 
# outdoor (n=53), median=5.0, scale=5.38, shape=0.55

Xue.data <-
  tribble(
    ~value,     ~age,     ~actobj.class,     ~param,     ~loc,     ~study,
    # Mouth_Hands shape parameters
    1.28,        3,         "Mouth_Hands",   "shape",   "Inside",  "Xue",
    NA,          3,         "Mouth_Hands",   "shape",   "Outside",  "Xue",
    1.02,        4,         "Mouth_Hands",   "shape",   "Inside",  "Xue",
    1.39,        4,         "Mouth_Hands",   "shape",   "Outside",  "Xue",
    0.91,        5,         "Mouth_Hands",   "shape",   "Inside",  "Xue",
    0.98,        5,         "Mouth_Hands",   "shape",   "Outside",  "Xue",
    0.76,        6,         "Mouth_Hands",   "shape",   "Inside",  "Xue", 
    0.56,        6,         "Mouth_Hands",   "shape",   "Outside",  "Xue",
    0.75,        7,         "Mouth_Hands",   "shape",   "Inside",  "Xue",
    0.55,        7,         "Mouth_Hands",   "shape",   "Outside",  "Xue",
    
    # Mouth_Hands scale parameters
    30.19,       3,         "Mouth_Hands",   "scale",   "Inside",  "Xue",
    NA,          3,         "Mouth_Hands",   "scale",   "Outside",  "Xue",
    19.01,       4,         "Mouth_Hands",   "scale",   "Inside",  "Xue",
    15.98,       4,         "Mouth_Hands",   "scale",   "Outside",  "Xue",
    18.79,       5,         "Mouth_Hands",   "scale",   "Inside",  "Xue",
    13.76,       5,         "Mouth_Hands",   "scale",   "Outside",  "Xue",
    11.04,       6,         "Mouth_Hands",   "scale",   "Inside",  "Xue", 
    3.41,        6,         "Mouth_Hands",   "scale",   "Outside",  "Xue",
    12.59,       7,         "Mouth_Hands",   "scale",   "Inside",  "Xue",
    5.53,        7,         "Mouth_Hands",   "scale",   "Outside",  "Xue",
    
    # Mouth_Hands shape parameters
    0.74,        3,         "Mouth_Fomites",   "shape",   "Inside",  "Xue",
    NA,          3,         "Mouth_Fomites",   "shape",   "Outside",  "Xue",
    1.66,        4,         "Mouth_Fomites",   "shape",   "Inside",  "Xue",
    NA,          4,         "Mouth_Fomites",   "shape",   "OUtside",  "Xue",
    1.39,        5,         "Mouth_Fomites",   "shape",   "Inside",  "Xue",   
    0.93,        5,         "Mouth_Fomites",   "shape",   "Outside",  "Xue",
    1.36,        6,         "Mouth_Fomites",   "shape",   "Inside",  "Xue",
    0.64,        6,         "Mouth_Fomites",   "shape",   "Outside",  "Xue",
    0.85,        7,         "Mouth_Fomites",   "shape",   "Inside",  "Xue",
    0.55,        7,         "Mouth_Fomites",   "shape",   "OUtside",  "Xue",
    
    # Mouth_Hands scale parameters
    9.83,        3,         "Mouth_Fomites",   "scale",   "Inside",  "Xue",
    NA,          3,         "Mouth_Fomites",   "scale",   "Outside",  "Xue",
    22.72,       4,         "Mouth_Fomites",   "scale",   "Inside",  "Xue",
    NA,          4,         "Mouth_Fomites",   "scale",   "Outside",  "Xue",
    15.54,       5,         "Mouth_Fomites",   "scale",   "Inside",  "Xue",   
    8.58,        5,         "Mouth_Fomites",   "scale",   "Outside",  "Xue",
    10.75,       6,         "Mouth_Fomites",   "scale",   "Inside",  "Xue",
    6.15,        6,         "Mouth_Fomites",   "scale",   "Outside",  "Xue",
    6.9,         7,         "Mouth_Fomites",   "scale",   "Inside",  "Xue",
    5.38,        7,         "Mouth_Fomites",   "scale",   "OUtside",  "Xue"
  )


weib.params <- 
  bind_rows(
    weib.inside.MH, 
    weib.outside.MH,
    weib.inside.MH_nd,
    weib.outside.MH_nd,
    weib.inside.MH_d,
    weib.outside.MH_d,
    weib.inside.MF,
    weib.outside.MF,
    Xue.data
  ) %>%
  arrange(study, age, actobj.class, loc, param) # %>%

# spread(-c(study, age, actobj.class, loc), key = "param", value = "value")


find.weib.values <- function(study, age, loc, actobj.class) {
  pweibull(seq(0, 1, 0.01),
           shape = 
             weib.params %>%
             filter(study == study, age == age, loc == loc, actobj.class == actobj.class, param == "shape") %>% 
             pull(value),
           scale = 
             weib.params %>%
             filter(study == study, age == age, loc == loc, actobj.class == actobj.class, param == "scale") %>% 
             pull(value)
  )
}

bind_cols(x = seq(0, 1, 0.01), y = find.weib.values("Bangladesh", 3, "Inside", "Mouth_Hands")) %>%
  ggplot(aes(x = x, y = y)) + 
  geom_line()

weib.params %>%
  filter(study == "Bangladesh", age == 3, loc == "Inside", actobj.class == "Mouth_Hands", param == "shape") %>% 
  pull(value)


```






# Make a table of the durations
```{r SI_Table2}
mouthing_touching_hands_obj_age.group_dur <-
  vo.9 %>%
  # Don't use vo because this is already an average by child. Instead use vo.9
  # vo %>% # already summed by location
  filter(
    obj.class %in% 
      c(
        # In vo.9 the obj.class are uncapitalized
        "hands_d", "hands_nd", "fomites"
        # "Hands", "Hands_d", "Hands_nd", "Fomites"
      )
  ) %>%
  # filter(
  #   actobj.class %in% 
  #     c(
  #       "Mouth_Hands", "Mouth_Hands_d", "Mouth_Hands_nd", "Mouth_Fomites")
  # ) %>%
  group_by(age.group, act, obj.class) %>%
  summarise_at(vars(dur), funs(mean, median, min, max), na.rm = TRUE) %>%
  mutate_if(is.numeric, funs(round), digits = 1) %>%
  arrange(act, age.group, obj.class)

# Duration for all ages combined
vo.9 %>% # already summed by location
  filter(
    obj.class %in% 
      c(
        # In vo.9 the obj.class are uncapitalized
        "hands_d", "hands_nd", "fomites"
        # "Hands", "Hands_d", "Hands_nd", "Fomites"
      )
  ) %>%
  group_by(act, obj.class) %>%
  summarise_at(vars(dur), funs(mean, sd, median, min, max), na.rm = TRUE) %>%
  mutate_if(is.numeric, funs(round), digits = 1) %>%
  arrange(act, obj.class)
```

## Mouthing Duration graph with trendline
```{r, fig.width=12}
vo.9 %>%
  # vo %>%
  filter(
    actobj.class %in% 
      c(
        "Mouth_hands_nd", "Mouth_hands_d", "Mouth_fomites"
        # "Mouth_Hands", "Mouth_Hands_nd", "Mouth_Hands_d", "Mouth_Fomites"
      )
  ) %>%
  mutate(
    actobj.class = 
      ordered(
        actobj.class,
        labels = 
          c(
            #"Hands\nall", 
            "Hands\nwhile eating", 
            "Hands\nwhile not eating", 
            "Objects"
          )
      ) 
  ) %>%
  ggplot(aes(age.mo, dur)) + 
  geom_hex(aes(color = age.group)) + # aes(color = hh)
  geom_smooth(method = "lm") + 
  scale_color_hue(
    name = "Age group",
    # breaks =
    #   c(3, 4, 5, 6, 7),
    labels =
      c(
        "3-5 months (n = 8)",
        # (n = 2 for hand mouthingrelated to eating or not)
        "6-11 months (n = 37)",
        # (n = 19 for hand mouthing related to eating or not)
        "12-23 months (n = 36)",
        # (n = 31 for hand mouthing related to eating or not)
        "24-35 months (n = 26)",
        "36-47 months (n = 6)"
      )
  ) +
  theme_bw() +  
  # theme(
  #   legend.position = "none"
  # ) +
  labs(
    title = "Duration of mouthing various items",
    caption = 
      "Dietary hand mouthing frequency of 600 for one child 10 months old not shown
* Fewer datapoints are availabe for disaggregated hand mouthing categories",
x = "Age in months",
y = "Mouthing duration (s/contacts)"

  ) +
  facet_grid(~actobj.class) # , switch = "x"
```







## Actually won't use this: Make a dataset with no duplicate children in the same age.group
Average the kids that appear in the same age group twice so that there will be only one entry for this child
-> I could use this in an analysis of age group
Better not to do age group analysis at all and rather just use the mixed model on the full dataset 

```{r}
vo.no.dups <-
  vo %>% # already does not include loc
  group_by(hh, sex_t, age.group, actobj.class, act, obj.class) %>%
  summarise(
    age.mo = mean(age.mo, na.rm = TRUE),
    dur.mean = weighted.mean(dur, w = freq, na.rm = TRUE),
    freq = mean(freq, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  select(hh, sex_t, age.mo, age.group, actobj.class, act, obj.class,  freq, dur.mean) # count,

# The following are segregated by location
vo.no.dups %>%
  arrange(desc(freq))
```







# visualize the data by location

## Frequency by age.group, loc and obj.class
```{r, fig.height=8, fig.width=12}
vo.loc %>%
  ggplot(aes(age.group, freq, color = loc)) + 
  geom_boxplot() + # varwidth = TRUE
  facet_grid(act ~ obj.class, scales = "free_y")
```

There is one crazy high frequency for eating by hand outside (both the Mouth_Foods and Mouth_Hands_d are high). I have reviewed these clips:

Clips with very high mouthing: vo3_hh4801_2153, 2154, 2156, 2157
* In clips 2153 and 2154 the child is eating lychee fruit and chips, which he is constantly putting in and out of his mouth
* In clip 2156 he is eating lychee, chips, and mango
* In clip 2157, he is eating chips

## Which parameters are significantly associated with mouthing frequency?
Examine ALL the so + vo data for this analysis

### Include sex_t as a fixed effect in mixed model for mouthing frequency?
```{r}
var2.sig.anova(vo, "Mouth_Hands", "sex_t +", "")

lmer(freq ~ sex_t + (1|hh), 
     data = 
       vo %>%
       filter(actobj.class == "Mouth_Hands"),
     control = lmerControl(optimizer = "Nelder_Mead")
)

```

Using the  Nelder-Mead optimiser and vo$freq ~ sex_t  + (1|hh) Examining the vo data, sex_t is not associated with mouthing frequency (X^2^ is  1.52 and p = 0.2166)

--> sex_t is not relevant to include in the model

### Include loc as a fixed effect in mixed model for mouthing frequency?
```{r}
lmer(freq ~ loc + (1 + loc|hh), 
     data = 
       vo.loc %>% # Must use the dataset that has loc in it
       filter(actobj.class == "Mouth_Hands"),
     control = lmerControl(optimizer = "Nelder_Mead")
)

var2.sig.anova(vo.loc, "Mouth_Hands", "loc +", "")
```

Using the  Nelder-Mead optimiser and vo.analyze$freq ~ loc + (1 + loc|hh). Examining the vo data only, loc is not associated with mouthing frequency (X^2^ is 0.332 and p = 0.5645) 

Could use all of the vo+so data but recall that a LOT of the so data didn't have location data recorded:
Using the  Nelder-Mead optimiser and vo$freq ~ loc + (1 + loc|hh). Examining the vo + so data, loc is not associated with mouthing frequency (X^2^ is 5.3466 and p = 0.06902) 

--> These indicate that loc should not be included as a fixed effect. 

### Mixed-effect model to test for significance of age.mo trend
Do NOT include sex as this has been found to be unimportant in other studies, and because including another variables divides the data into categories so small they can't be analyzed. 


```{r}

# lmer(freq ~ age.mo + (1|hh), 
#      # The model below makes (more?) sense but it more complicated and 
#      # I don't have much data so I'll use the simplier model
#      # freq ~ age.mo + loc + (1 + loc|hh)
#      data = 
#        vo %>%
#        filter(actobj.class == "Mouth_Hands"),
#      control = lmerControl(optimizer = "Nelder_Mead")
# )
# 
# model <- 
#   lmer(freq ~ age.mo + (1|hh), 
#        data = 
#          vo %>%
#          filter(actobj.class == "Mouth_Hands"),
#        # control = lmerControl(optimizer = "Nelder_Mead"),
#        REML = FALSE
#   )
# 
# null <- 
#   lmer(freq ~ (1|hh), 
#        # null model must have same random effect structure as full model, 
#        # so even if remove age.mo as a fixed effects for the null model, 
#        # keep 1 + age.mo|hh in the fixed effects
#        data = 
#          vo %>%
#          filter(actobj.class == "Mouth_Hands"),
#        #control = lmerControl(optimizer = "Nelder_Mead"),
#        REML = FALSE
#   )
# 
# anova(null, model)

freq.trend(vo, "Mouth_Hands")

var2.sig.anova(vo, "Mouth_Hands", "age.mo +", "")
```

I have shown above that loc should not be included as a fixed effect, so  

Using the video data, and the Nelder-Mead optimizer and vo$freq ~ age.mo + (1|hh), there is not an association of age.mo with Mouth_hands freq (X^2^ = 0.303, p = 0.582)


```{r}
freq.trend(vo, "Mouth_Hands_d")

var2.sig.anova(vo, "Mouth_Hands_d", "age.mo +", "")
```

The frequency of dietary hand mouthing was not assciated with age (X^2^ = 0.8396, p = 0.3595).

```{r}
freq.trend(vo, "Mouth_Hands_nd")

var2.sig.anova(vo, "Mouth_Hands_nd", "age.mo +", "")
```

The frequency of non-dietary hand mouthing was not associated with age (X^2^ = 3.177, p = 0.05336). Increase one mo in age was associated with a DEcrease of 0.47 contacts/hr

## Mouthing by mobility
```{r}
freq.trend.mobility(vo, "Mouth_Hands")

var2.sig.anova(vo, "Mouth_Hands", "mobility +", "")
```

Hand mouthing frequency is marginally associated with mobility (X^2^ = 0.2145, p = 0.6432)

```{r}
freq.trend.mobility(vo, "Mouth_Hands_d")

res <- var2.sig.anova(vo, "Mouth_Hands_d", "mobility +", "") 

res$Chisq[2]
res$`Pr(>Chisq)`[2]

# Hand mouthing while eating frequency is not associated with mobility
# (X^2^ = `r res$Chisq[2]`, p = `r res$`Pr(>Chisq)`[2]`)


var2.sig.anova(vo, "Mouth_Hands_d", "mobility +", "") 
```


Hand mouthing while eating frequency is not associated with mobility (X^2^ = 1.9604, p = 0.1615)

```{r}
freq.trend.mobility(vo, "Mouth_Hands_nd")

var2.sig.anova(vo, "Mouth_Hands_nd", "mobility +", "")
```

Hand mouthing while NOT eating frequency is associated with mobility (X^2^ = 15.324, p = 9.06e-5), with an increase from crawling to walking associated with 24.42 fewer hand-to-mouth contacts/hr while not eating

## objects
```{r}
freq.trend.mobility(vo, "Mouth_Fomites")

var2.sig.anova(vo, "Mouth_Fomites", "mobility +", "")
```

The frequency of fomite mouthing was not assciated with mobility (X^2^ = 28.769, p = 8.15e-8).


## Didn't use the following, because instead in the code above I used all the data available (SO + VO)
_Using the video data ONLY_
Use vo.analyze, which is divided by age, location, and sex. I think the model accounts for this in freq ~ age.mo + (1|hh)

```{r}
lmer(freq ~ age.mo + (1|hh), 
     data = 
       vo %>%
       filter(actobj.class == "Mouth_Hands")#,
     #control = lmerControl(optimizer = "Nelder_Mead")
)

model <- 
  lmer(freq ~ age.mo + (1|hh), 
       data = 
         vo %>%
         filter(actobj.class == "Mouth_Hands"),
       #control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

null <- 
  lmer(freq ~ (1|hh), 
       data = 
         vo %>%
         filter(actobj.class == "Mouth_Hands"),
       #control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

anova(null, model)
```


## Duration by age.group, loc and obj.class
```{r, fig.height=8, fig.width=12}
vo.9 %>%
  filter(!is.na(act), !is.na(obj.class), obj.class %notin% c("Nothing", "NotInView")) %>%
  ggplot(aes(age.group, dur, color = loc)) + # not sure how to use group here to get boxplots
  geom_boxplot(varwidth = TRUE) + 
  labs(title = "DURATION of hand mouthing") +
  facet_grid(act ~ obj.class, as.table = FALSE, scales = "free_y")
```


### Duration 
```{r}

lmer(dur ~ age.mo + (1|hh), 
     # The model below makes (more?) sense but it more complicated and 
     # I don't have much data so I'll use the simplier model
     # freq ~ age.mo + loc + (1 + loc|hh)
     data = 
       vo.9 %>%
       left_join(mobility.all.obs, by = c("round", "hh")) %>%
       filter(actobj.class == "Mouth_hands_nd") %>%
       mutate_at(vars(round, hh), funs(as.factor)),
     control = lmerControl(optimizer = "Nelder_Mead")
)

model <- 
  lmer(dur ~ mobility  + (1|hh), # age.mo
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Mouth_hands_nd") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       # control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

null <- 
  lmer(dur ~ (1|hh), 
       # null model must have same random effect structure as full model, 
       # so even if remove age.mo as a fixed effects for the null model, 
       # keep 1 + age.mo|hh in the fixed effects
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Mouth_hands_nd") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       #control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

anova(null, model)
```

There was no association between age and duration of non-dietary hand mouthing (p = 0.366).
There was no association between mobility and duration of non-dietary hand mouthing (p = 0.4863).

```{r}

lmer(dur ~ mobility + (1|hh), 
     # The model below makes (more?) sense but it more complicated and 
     # I don't have much data so I'll use the simplier model
     # freq ~ age.mo + loc + (1 + loc|hh)
     data = 
       vo.9 %>%
       left_join(mobility.all.obs, by = c("round", "hh")) %>%
       filter(actobj.class == "Mouth_hands_d") %>%
       mutate_at(vars(round, hh), funs(as.factor)),
     control = lmerControl(optimizer = "Nelder_Mead")
)

model <- 
  lmer(dur ~ mobility + (1|hh), 
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Mouth_hands_d") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       # control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

null <- 
  lmer(dur ~ (1|hh), 
       # null model must have same random effect structure as full model, 
       # so even if remove age.mo as a fixed effects for the null model, 
       # keep 1 + age.mo|hh in the fixed effects
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Mouth_hands_d") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       #control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

anova(null, model)
```

There was no association between age and duration of dietary hand mouthing (p = 0.2814). 
There was an association between mobility and duration of dietary hand mouthing (p = 7.209e-7). 
Transitioning from crawling to walking was associated with a decrease in duration of each contact by 0.7399 seconds

```{r}
lmer(dur ~  mobility + (1|hh), # age.mo
     # The model below makes (more?) sense but it more complicated and 
     # I don't have much data so I'll use the simplier model
     # freq ~ age.mo + loc + (1 + loc|hh)
     data = 
       vo.9 %>%
       left_join(mobility.all.obs, by = c("round", "hh")) %>%
       filter(actobj.class == "Mouth_fomites") %>%
       mutate_at(vars(round, hh), funs(as.factor)),
     control = lmerControl(optimizer = "Nelder_Mead")
)

model <- 
  lmer(dur ~ mobility  + (1|hh), # age.mo
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Mouth_fomites") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       # control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

null <- 
  lmer(dur ~ (1|hh), 
       # null model must have same random effect structure as full model, 
       # so even if remove age.mo as a fixed effects for the null model, 
       # keep 1 + age.mo|hh in the fixed effects
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Mouth_fomites") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       #control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

anova(null, model)
```

There was an association between age and duration of fomite mouthing (p = 1.04e-4). For each month increase in age, the duration of each object-to-mouth contact increased by 0.06472 so a year increase in age is associated with a 0.77664 s increase in the duration of each object-to-mouth contact.

0.06472 * 12 = 0.77664

No association between mobility and duration of fomite mouthing (WHY?) p = 0.1114






# Touching, divided by age group only

```{r}
vo %>%
  filter(
    actobj.class %in% 
      c("Touch_Water", "Touch_Foods", "Touch_Soil", "Touch_Fomites")
  )
```

## Touching graph with trendline
```{r, fig.width=12}
vo %>%
  filter(
    actobj.class %in% 
      c("Touch_Water", "Touch_Foods", "Touch_Soil", "Touch_Fomites")
  ) %>%
  mutate(
    actobj.class = 
      ordered(
        actobj.class,
        levels = 
          c("Touch_Water", "Touch_Foods", "Touch_Soil", "Touch_Fomites"),
        labels = 
          c("Water", "Foods", "Soil", "Objects")
      ), 
    mobility = 
      ordered(
        mobility,
        levels = c(0, 1, 2), 
        labels = c("Immobile", "Crawling", "Walking")
      )
  ) %>%
  ggplot(aes(age.mo, freq)) + 
  geom_point(aes(color = age.group, shape = mobility)) + # aes(color = hh)
  #  geom_smooth(method = "lm") + 
  scale_color_hue(
    # name = "Age group",
    # breaks =
    #   c(3, 4, 5, 6, 7),
    labels =
      # n are for VIDEO OBS only because no touching captured in SO
      c(
        "3-5 months (n = 2)", # NOT n = 8 for SO  + VO
        "6-11 months (n = 19)", # NOT n = 37 for SO  + VO
        "12-23 months (n = 31)", # NOT n = 36 for SO  + VO
        "24-35 months (n = 26)",
        "36-47 months (n = 6)"
      )
  ) +
  scale_shape_manual(
    breaks = c("Walking", "Crawling", "Immobile"),
    labels = c("Walking", "Crawling", "Immobile"),
    values = c(10, 4, 1)
  ) +
  labs(
    # title = "Frequency of touching various items among young children in rural Bangladesh",
    x = "Age in months",
    y = "Touching freqency (contacts/hr)",
    color = "Age group",
    shape = "Mobility"
  ) +
  theme_bw() +  
  theme(
    legend.position = "right",
    # legend.position = c(0.01, 0.99),
    # legend.justification = c(0, 1),
    # legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
    # text = element_text(size = 8),
    legend.text = element_text(size = 9),
    plot.caption = element_text(size = 8, hjust = 0, margin = margin(t = 15))
  ) +
  guides(
    color = guide_legend(order = 1),
    shape = guide_legend(order = 2, reverse = TRUE)
  ) + 
  facet_grid(~actobj.class)

ggsave(
  filename = "touching.linear.legend.right.png", 
  path = "C:/Users/lenovo/Box Sync/VO R123/",
  device = "png", 
  scale = 1.5,
  width = 6.5, 
  height = 4,
  units = "in",
  dpi = 1000
)
```


## Boxplot of Touching
```{r, fig.width=12}
vo %>%
  filter(
    actobj.class %in% 
      c("Touch_Water", "Touch_Foods", "Touch_Soil", "Touch_Fomites")
  ) %>%
  mutate(
    actobj.class = 
      ordered(
        actobj.class,
        labels = 
          c("Water", "Foods", "Soil", "Objects")
      ) 
  ) %>%
  ggplot(aes(age.group, freq, color = age.group)) +
  geom_boxplot(width = 1, outlier.shape = NA) + # varwidth = TRUE,  
  geom_jitter(width = 0.1, alpha = 0.4) +
  scale_color_hue(
    labels =
      c(
        "3-5 months (n = 2)",
        "6-11 months (n = 19)",
        "12-23 months (n = 31)",
        "24-35 months (n = 26)",
        "36-47 months (n = 6)"
      )
  ) +
  labs(
    # title = "Frequency of Touching Various Items, by Age Group", 
    y = "Frequency (contacts / hr)",
    color = "Age group"
  ) +
  theme_bw() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 16),
    strip.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 16),
    axis.title.y = element_text(size = 16),
    axis.text.x = element_blank(),
    axis.ticks.length = unit(0, "cm"),
    axis.title.x = element_blank(),
    legend.background = element_rect(fill = "white"),
    legend.position = c(0.01, 0.99),
    legend.justification = c(0, 1),
    legend.title = element_text(size = 8),
    legend.text = element_text(size = 8)
  ) +
  facet_grid(. ~ actobj.class) # , switch = "x"

ggsave(
  filename = "touching.boxplot.png", 
  path = "C:/Users/lenovo/Box Sync/VO R123/",
  device = "png", 
  scale = 1.5,
  width = 6.5, 
  height = 4,
  units = "in",
  dpi = 1000
)
```

## Which parameters are significantly associated with touching frequency?
## Mixed-effect model to test for significance of trend
```{r}
# freq.trend(vo.T.age.group, "Touch_Water")
# var.sig.anova(vo.T.age.group, "Touch_Water")
```

The frequency of ___ __creased with age (X^2^ = xxx, p = xxx), with each month increasing the frequency by xx contacts/hr +- xx se.

## Touching Food
```{r}
freq.trend(vo, "Touch_Foods")
var2.sig.anova(vo, "Touch_Foods", "age.mo +", "")
```

The frequency of touching foods increased with age (X^2^ = 19.215, p < 1.187e-5), with each month increasing the frequency by 6.080 contacts/hr.

### Why does the frequency of touching foods INCREASE with age?
Maybe this is due to specific children driving the apparent trend downwards we observed above. Plot here considernig the child.

```{r}
vo %>%
  filter(
    actobj.class %in% 
      c("Touch_Water", "Touch_Foods", "Touch_Soil", "Touch_Fomites")
  )  %>%
  mutate(
    actobj.class = 
      ordered(
        actobj.class,
        labels = 
          c("Water", "Foods", "Soil", "Objects")
      ) 
  ) %>%
  ggplot(aes(age.mo, freq)) + 
  geom_point(aes(color = hh)) + 
  geom_smooth(aes(color = hh), method = "lm", se = FALSE, alpha = 0.1) +
  geom_smooth(method = "lm") +
  labs(title = "Frequency of touching various items") +
  facet_grid(~actobj.class)
```

The trendline goes downwards but the stats says there is a sig increase upwards... Perhaps this is driven by a few kids who went up sharply?
--> I think it is because the model has random effects for the intercept of each child whereas the linear fit that I can see combines all the data to have the same intercept

## Types of foods touched
```{r}
vo.9 %>%
  filter(actobj.class == "Touch_foods") %>%
  count(obj, sort = TRUE) %>%
  mutate(pc = n / sum(n) * 100)
```


## I'll look at Soil later

## Touching Fomites
```{r}
freq.trend(vo, "Touch_Fomites")
var2.sig.anova(vo, "Touch_Fomites", "age.mo +", "")
```

The frequency of touching objects was not associated with age (X^2^ = 2.4217, p = 0.1197).

## Touching Fomites by mobility
```{r}
freq.trend.mobility(vo, "Touch_Fomites")
var2.sig.anova(vo, "Touch_Fomites", "mobility +", "")

```

The frequency of touching fomites was associated with mobility (X^2^ = 5.5603, p = 0.01837), with an increase in mobility from crawling to walking associated a DEcrease of 96.15 contacts/hr (781.48 when crawling vs 685.33 when walking).

## Types of objects touched
```{r}
vo.9 %>%
  filter(actobj.class == "Mouth_fomites") %>%
  count(obj, sort = TRUE) %>%
  mutate(pc = n / sum(n) * 100)

vo.9 %>%
  filter(actobj.class == "Touch_fomites") %>%
  count(obj, sort = TRUE) %>%
  mutate(pc = n / sum(n) * 100)
```

## Duration of touching objects

```{r}
model <- 
  lmer(dur ~  age.mo + (1|hh), # mobility
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Touch_fomites") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       # control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

null <- 
  lmer(dur ~ (1|hh), 
       data = 
         vo.9 %>%
         left_join(mobility.all.obs, by = c("round", "hh")) %>%
         filter(actobj.class == "Touch_fomites") %>%
         mutate_at(vars(round, hh), funs(as.factor)),
       #control = lmerControl(optimizer = "Nelder_Mead"),
       REML = FALSE
  )

anova(null, model)

lmer(dur ~  age.mo + (1|hh), # mobility
     data = 
       vo.9 %>%
       left_join(mobility.all.obs, by = c("round", "hh")) %>%
       filter(actobj.class == "Touch_fomites") %>%
       mutate_at(vars(round, hh), funs(as.factor)),
     control = lmerControl(optimizer = "Nelder_Mead")
)

vo.9 %>%
  filter(actobj.class == "Touch_Fomites") %>%
  ggplot(aes(age.mo, dur, color = mobility)) +
  geom_point() + 
  geom_smooth()
```

The duration of touching fomites was associated with age in months (p = 2.2e-16), with an increase in one month of age associated with 0.1552 s longer duration of touching an object.

So aging one year = 0.1552 * 12 = 1.8624 s touch during each hand-object contact

The duration of touching fomites was associated with mobility (p = 2.2e-16), with an increase in mobility from crawling to walking associated a decrease of 4.117 seconds per contact.


## Types of animals touched
```{r}
vo.9 %>%
  filter(actobj.class == "Touch_animals") %>%
  count(obj, sort = TRUE) %>%
  mutate(pc = n / sum(n) * 100)
```

## Animals in Structured Observations
animal 1=cow/buffalo, 2=goat/sheep, 3=poultry, 4=dog/cat, 77=other
Object = 6 means interacting with animal
I'm not sure what object = 1, animal != NA means

```{r}
read_csv(file_so.obs) %>%
  separate_rows(object, sep = " ") %>%
  filter(!is.na(animal)) %>%
  count(object, animal) 

read_csv(file_so.obs) %>%
  separate_rows(object, sep = " ") %>%
  filter(!is.na(animal), object == 6) %>%
  count(participant_id) 
```
In 5 * 149 = 745 hours of structured observation (about 500 hours when the child was awake), there were 19 EPISODES of contacts with animals (we don't know how many contacts occurred in each episode )

## Animals in Video observations
```{r}
vo.9 %>%
  filter(cObj %in% Animals) %>%
  # For now, before reviewing the videos,
  # assume all of the actions were touching and that "Hand&&ObjInMouth" and "ObjectInMouth" are mistakes from coding transitions
  count(round, hh, cObj) #%>%
#count(hh, cObj)
```
In the 84 6-hour video observations, 15/30 unique children interacted with animals.
Total 19 child-round observations. 17 of these had 1 to approx 50 contacts, but one had 192 contacts (with a chicken)


## Mouthing of soil

### Location
```{r}
vo.loc %>%
  filter(actobj.class == "Mouth_Soil") %>%
  group_by(loc, mobility) %>%
  count()
```

Soil was ingested 8 times indoors and 12 times outdoors. In 6 instances the child could crawl but not walk and in 14 instances the child could walk. 

### Soil ingestion from VO only
Should I report the trevalence in the VO only since Kwong_2016 reported SO results? But this is then inconsistent with the rest of the analysis....
```{r}
# Don't group and count or may collapse two events by the same child into one event
vo.loc %>%
  filter(actobj.class == "Mouth_Soil")

vo.loc %>%
  filter(actobj.class == "Mouth_Soil") %>%
  group_by(hh) %>%
  count()

vo.loc %>%
  filter(actobj.class == "Mouth_Soil") %>%
  group_by(hh, round) %>%
  count()

vo.loc %>%
  group_by(round, hh) %>%
  count() %>%
  nrow()
# There were 84 total observations

vo.loc %>%
  filter(actobj.class == "Mouth_Soil") %>%
  group_by(round, hh) %>%
  count() %>%
  nrow()
# In these 84 observations, there were 19 children-rounds in which a child put soil in the mouth = 19/84 * 100 = 22.62%



soil.ingestion.age.group <- 
  vo.loc %>%
  filter(actobj.class == "Mouth_Soil") %>% # round != "so1", 
  # Now can collapse because want to get prevalence of any soil ingestion (ok to collapse multiple events)
  group_by(hh, age.group) %>%
  count() %>%
  group_by(age.group) %>%
  count()

```

There were 20 soil ingestion events in the VO by 15 unique children. One child (38101) ingested in each observation, two children (44607 and 49505) ingested soil in two of three observations (I checked - they both were in all three rounds of obs), and one child (20801) ingested twice in the same observation. 




```{r}
vo.num.age.group %>%
  left_join(soil.ingestion.age.group, by = "age.group") %>%
  mutate(
    nn = if_else(!is.na(nn), nn, 0L), 
    prev = round(nn / n * 100, 1)
  ) %>%
  dplyr::select(age.group, nn, n, prev)
```

### Location
```{r}
vo.loc %>%
  filter(actobj.class == "Mouth_Soil") %>% # round != "so1", 
  group_by(loc) %>%
  count()
```

```{r}
freq.trend(vo, "Mouth_Soil")

var2.sig.anova(vo, "Mouth_Soil", "age.mo +", "")
```

The frequency of mouthing soil was not associated with age (x^2^ = 0, p = 0.9951)

```{r}
vo %>%
  filter(actobj.class == "Mouth_Soil") %>%
  group_by(mobility) %>%
  summarise(freq.mean = mean(freq, na.rm = TRUE))
```

```{r}
freq.trend.mobility(vo, "Mouth_Soil")

var2.sig.anova(vo, "Mouth_Soil", "mobility +", "")
```

The frequency of mouthing soil was not associated with mobility (x^2^ = 0, p = 1).


# Touching soil
```{r}
vo %>% # already summed by location
  filter(obj.class == "Soil") %>%
  group_by(age.group, act, obj.class) %>%
  summarise_at(vars(freq), funs(mean, median, min, max)) %>%
  mutate_if(is.numeric, funs(round), digits = 1) %>%
  arrange(act, age.group, obj.class)
```

```{r}
freq.trend(vo, "Touch_Soil")
var2.sig.anova(vo, "Touch_Soil", "age.mo +", "")
```

The frequency of touching soil decreased with age (X^2^ = 29.429, p < 0.001), with each month decreasing the frequency by 6.031 contacts/hr = 75.6 fewer contacts/yr

## Mouthing Soil by mobility
```{r}
freq.trend.mobility(vo, "Touch_Soil")
var2.sig.anova(vo, "Touch_Soil", "mobility +", "")
```

The frequency of touching soil was associated with mobility (X^2^ = 4.7335, p = 0.02958), with an increase in mobility from crawling to walking associated a DEcrease of 85.38 contacts/hr.

## Mouthing of feces

### Location
```{r}
vo.loc %>%
  filter(actobj.class == "Mouth_Feces") %>%
  group_by(loc) %>%
  count()
```

This ingestion of feces is recorded as "Inside" but I watched the video and the child was definitly outside. 

### Prevalence in the VO only (Kwong, 2016 paper reported SO results)
```{r}

vo %>%
  filter(actobj.class == "Mouth_Feces") %>%
  group_by(hh, age.group) %>%
  count() %>%
  ungroup() %>%
  summarise(tot = sum(n, na.rm = TRUE))

vo.loc %>%
  group_by(round, hh) %>%
  count() %>%
  nrow()
# There were 84 total observations

vo.loc %>%
  filter(actobj.class == "Mouth_Feces") %>%
  group_by(round, hh) %>%
  count() %>%
  nrow()
# In these 84 observations, there were 1 children-rounds in which a child put soil in the mouth = 1/84*100 = 1.19%  

feces.ingestion.age.group <- 
  vo %>%
  filter(actobj.class == "Mouth_Feces") %>%
  group_by(hh, age.group, age.mo, mobility) %>%
  count() %>%
  group_by(age.group, age.mo, mobility) %>%
  count()

feces.ingestion.age.group
```

There was only one observation in which a child ingested feces and the singular ingestion event was outside. 

```{r}
vo.num.age.group %>%
  left_join(feces.ingestion.age.group, by = "age.group") %>%
  mutate(
    nn = if_else(!is.na(nn), nn, 0L), 
    prev = round(nn / n * 100, 1)
  ) %>%
  dplyr::select(age.group, nn, n, prev)

```



## Touching feces


### Type in VO
```{r}
vo.9 %>%
  filter(actobj.class == "Touch_feces") %>%
  group_by(obj) %>%
  select(round, hh, clip, hand, coder, timestamp, age.group, age.mo, actobj.class, obj)
```


There were 17 instances of children touching feces - 4 times with adult feces (three children age 8, 9, and 13 mo, one child twice in one single episode), 8 times with goat/cow feces (two children, one child seven times in one single episode), three times with child's own feces (same child age 9 mo in one single episode), and 2 times with chicken feces (two children ag 6 and 9 mo)


### Location
```{r}
vo.loc %>%
  filter(actobj.class == "Touch_Feces") %>%
  group_by(loc) %>%
  count()
```

I don't know if I can trust this location result, given that the consuming feces was listed as inside but actually occured outside -> I should have done even better QA. 

### Prevalence in the VO only (Kwong, 2016 paper reported SO results)

* By age.group
```{r}

vo %>%
  filter(actobj.class == "Touch_Feces") %>%
  group_by(hh, age.group) %>%
  count() %>%
  ungroup() %>%
  summarise(tot = sum(n, na.rm = TRUE))

feces.touching.age.group <- 
  vo %>%
  filter(actobj.class == "Touch_Feces") %>%
  group_by(hh, age.group) %>%
  count() %>%
  group_by(age.group) %>%
  count()
```

```{r}
vo %>%
  distinct(round, hh, .keep_all = TRUE) %>%
  group_by(age.group) %>%
  count() %>%
  left_join(feces.touching.age.group, by = "age.group") %>%
  mutate(
    nn = if_else(!is.na(nn), nn, 0L), 
    prev = round(nn / n * 100, 1)
  ) %>%
  dplyr::select(age.group, nn, n, prev)
```

There were 8 instances of touching animal feces by 8 children, 6/38 (15.8%) of 6-11 months old and 2/36 (5.6%) of 12-24 months old. 

* By mobility 
```{r}
feces.touching.mobility <- 
  vo %>%
  filter(actobj.class == "Touch_Feces") %>%
  group_by(hh, mobility) %>%
  count() %>%
  group_by(mobility) %>%
  count()
```

```{r}
vo %>%
  distinct(round, hh, .keep_all = TRUE) %>%
  group_by(mobility) %>%
  count() %>%
  left_join(feces.touching.mobility, by = "mobility") %>%
  mutate(
    nn = if_else(!is.na(nn), nn, 0L), 
    prev = round(nn / n * 100, 1)
  ) %>%
  dplyr::select(mobility, nn, n, prev)
```

There were 8 instances of touching animal feces by 8 children, 4/27 (14.8%) of children who could only crawl and 4/71 (5.6%) of children who could walk. 


# Evaluate contacts while feeding
## This didn't work so used the original R file instead: R Mouthing/VO Food analysis/VO_FoodAnalysis_171009.R

## What percent of total time was time feeding?
```{r}
pc_feeding_time <- 
  vo.9 %>%
  # Filter by hand = "R" and get distinct 
  # to make sure that we are not double-counting
  filter(hand == "R", event == "Feeding") %>% 
  distinct(round, hh, realtime, .keep_all = TRUE) %>%
  group_by(round, hh, age.group) %>%
  
  summarise(feeding.hrs = (sum(dur, na.rm = TRUE)/(60*60))) %>%
  left_join(
    vo.awake.loc %>% 
      group_by(round, hh) %>% 
      summarise(rec.h = sum(rec.h, na.rm = TRUE)), 
    by = c("round", "hh")
  ) %>%
  mutate(pc_feeding_time = (feeding.hrs/rec.h)*100)

pc_feeding_time_median <- 
  pc_feeding_time  %>%
  group_by(age.group) %>%
  summarise_at(vars(pc_feeding_time), funs(mean, median, min, max))
```

The average percentage of the observation that children consumed food other than breastmilk varied from 5% for children 3-6 months old to 14% for children 36-47 months old. 

## How long was each feeding event?
Was it reasonable to define a feeding event as within 15 secods of last contacts of food?
I used this definition in VO_step3_pre-process_data

```{r}
event_durations <- 
  vo.9 %>%
  filter(hand == "R") %>% # Make sure we are not double-counting
  arrange(round, hh, hand, realtime) %>%
  # distinct(round, hh, hand, .keep_all = TRUE) %>% # realtime, keeps only one entry from round, hh, hand, realtime so if there is Mouth_hand and Mouth_food at the same realtime, only the first that appears will be kept. 
  mutate(event.num = as.numeric(as.factor(event))) %>%
  # #group_by(round, hh, clip, event_label = cumsum(c(1, diff(event.num) != 0 )), event) %>%
  # group_by(round, hh, age.group, clip) %>%
  mutate(event_label = cumsum(c(1, diff(event.num) != 0))) %>%
  # select(round, hh, hand, realtime, event, event.num, event_label) %>%
  # filter(event_label == 2)
  group_by(round, hh, age.group, clip, event_label, event) %>%
  summarise(start_time = min(timestamp), end_time = max(timestamp), dur = end_time - start_time) %>%
  mutate(clip1 = clip) %>%
  unite(clip.event_label, clip1, event_label)

event_durations %>%
  group_by(event) %>% # age.group
  filter(dur != 0) %>% # dur = 0 is a glitch
  summarise_at(vars(dur), funs(mean, median, min, max)) %>%
  arrange(event) # , age.group

event_durations %>%
  ggplot(aes(event, dur)) +
  geom_boxplot(aes(group = event)) +
  theme(axis.text.x = element_text(angle = -45, hjust = 0)) +
  # One outlier for playing at 2000 s
  facet_grid( ~ age.group)
```

I defined a feeding event to be within 15 seconds of contact with food, but an actual feeding event is a median 42 s, mean of ~95 seconds, max is 1981 s =  33 min

# Duration of eating period related to Mouth_hands_d?
```{r}
# Correlation between duration of a feeding periods and frequency of Mouth_hands_d?

feeding_dur_freq <-
  vo.9 %>%
  filter(hand == "R") %>% # Make sure we are not double-counting
  arrange(round, hh, hand, realtime) %>%
  # distinct(round, hh, hand, .keep_all = TRUE) %>% # realtime, keeps only one entry from round, hh, hand, realtime so if there is Mouth_hand and Mouth_food at the same realtime, only the first that appears will be kept.  
  mutate(event.num = as.numeric(as.factor(event))) %>%
  # #group_by(round, hh, clip, event_label = cumsum(c(1, diff(event.num) != 0 )), event) %>%
  # group_by(round, hh, age.group, clip, actobj.class) %>%
  mutate(event_label = cumsum(c(1, diff(event.num) != 0))) %>%
  group_by(round, hh, age.group, clip, event_label, event, actobj.class) %>% # , actobj.class
  summarise(count = n()) %>%
  mutate(clip1 = clip) %>%
  unite(clip.event_label, clip1, event_label) %>%
  left_join(event_durations %>% select(clip.event_label, event, dur)) %>%
  mutate(freq = count / dur) %>%
  filter(event == "Feeding")

feeding_dur_freq %>%
  ungroup() %>%
  filter(actobj.class == "Mouth_hands", dur > 0) %>%
  select(freq, dur) %>%
  cor(method = "pearson") # pearson takes the actual values, spearman takes the ranks

unique(feeding_dur_freq$actobj.class)
```

Correlation between Mouth_hands_d freq and duration of feeding period (no account for within-child correlation) is low: -0.1531

Correlation between Mouth_food freq and duration of feeding period (no account for within-child correlation) is low: -0.1466

Correlation between Mouth_fomites (which includes utensils) freq and duration of feeding period (no account for within-child correlation) is low: -0.17289

Why is there no Mouth_utensils in feeding_dur_freq? I don't know. Don't worry about it now. 

## Frequency of EVENTS (not contacts) in which child feeds himself/herself
Unique events have a break in the contacts with event == feeding.
Contacts labeled feeding are within 15 seconds before or after mouth contacts with food, so unique events have at least 30 seconds between food and mouth contacts.
if the round, hh, clip match and the timestamp associated with the Feeding - ChildHand event is within start_time, end_time, then label that feeding event as "caregiver-associated"
# one step at a time. Want to add if there is any(obj) == "ChildHand"

```{r, eval = FALSE}
feeding.by.child <- 
  vo.9 %>%
  filter(hand == "R") %>% # Make sure we are not double-counting
  #distinct(round, hh, hand, realtime) %>%
  mutate(event.num = as.numeric(event)) %>%
  filter(event == "Feeding", act == "Mouth", obj %in% c("ChildHand")) %>% #"ChildHand", # These are the feeding clips in which the child fed herself
  mutate(feeding.by.child = 1) %>%
  select(round, hh, clip, event, act, obj, timestamp, feeding.by.child) %>%
  arrange(round, hh, clip, timestamp) # without arrange, the timestamps are out of order because they are all touch.soil associated with act1, then act2, then act3, then act4
```

## Determine the frequency of feeding events in which the child fed the child

We assume there is no recontamination of caregiver hands between individual caregiver hand-to-mouth contacts while feeding and only recontamination between feeding events,
Hence we need to find the frequency of caregiver-associated feeding events for each child. 

```{r, eval = FALSE}
clips.event.feeding.by.child <- 
  full_join(feeding.by.child, event_durations %>% 
              filter(event == "Feeding"), 
            by = c("round", "hh", "clip", "event")
  ) %>%
  mutate(hand.mouth.contact.while.eating = ifelse(timestamp > start_time & timestamp < end_time, 1, 0)) %>%
  arrange(clip.event_label) %>%
  group_by(clip.event_label) %>%
  summarise(hand.mouth.contact.while.eating.sum = sum(hand.mouth.contact.while.eating)) %>%
  mutate(hand.mouth.contact.while.eating.yn = ifelse(hand.mouth.contact.while.eating.sum >= 1, 1, 0)) %>%
  select(clip.event_label, hand.mouth.contact.while.eating.yn)
# Because we had to check the timestamp of each feeding.caregiver.associated row against the range of times of the feeding events and each of these feeding events are labeled with an event_label
# there are multiple of the same event_labels. If any of these same event_labels have event.feeding.caregiver.specific == 1, then event.feeding.caregiver == 1. 

## places where the event is feeding but the feeding.by.child is NA, it means that child was not involved in that feeding event.
event_durations.child.feeding <- 
  event_durations %>%
  left_join(clips.event.feeding.by.child, by = "clip.event_label")

feeding.child.freq <- 
  event_durations.child.feeding %>%
  left_join(all.dem.data %>% select(round, hh, age.mo), by = c("round", "hh")) %>%
  group_by(round, hh, age.mo) %>%
  summarise(hh.feeding.events = sum(hand.mouth.contact.while.eating.yn, na.rm = TRUE)) %>%
  right_join(
    vo.awake.loc %>% 
      group_by(round, hh) %>% 
      summarise(rec.h = sum(rec.h, na.rm = TRUE)), 
    by = c("round", "hh")
  ) %>%
  mutate(feeding.child.freq = hh.feeding.events / rec.h) 

# # Use this file in determining soil consumption from child's hands. 
# write.csv(feeding.child.freq, "C:/Users/Tareq/Box Sync/VO R123/feeding.child.freq.csv")

```





# Tertile analysis to identify high-frequency mouthers

## Mouth_Hands

### Kruskal-Wallis test method

This could have probably replaced all ther tertile analysis below, but didn't think of it until perhaps a year later 
(Shrey suggested the Kruskal test, Sainani had suggested the tertile analysis; Nina suggested the empirical bootstrapped analysis)

```{r}
kruskal.test(freq ~ hh, data = vo %>% filter(actobj.class == "Mouth_Hands")) # p = 0.378
kruskal.test(freq ~ hh, data = vo %>% filter(actobj.class == "Mouth_Hands_nd")) # p = 0.3687
kruskal.test(freq ~ hh, data = vo %>% filter(actobj.class == "Mouth_Hands_d")) # p = 0.281
kruskal.test(freq ~ hh, data = vo %>% filter(actobj.class == "Mouth_Fomites")) # p = 0.3883
```


### Tertile method

--> There is no high-frequency mouther in any category Mouth_Hands, Mouth_Hands_nd, Mouth_Fomites

* Mouth_Hands
```{r}
vo %>%
  filter(actobj.class == "Mouth_Hands") %>%
  group_by(round) %>%
  arrange(round, desc(freq)) %>%
  mutate(
    rank = row_number(), # wow!!! That previously took me SO much code!
    tertile = cut(rank, breaks = 3, labels = c(1, 2, 3))
  ) %>%
  ungroup() %>%
  select(round, hh, tertile) %>%
  spread(key = "round", value = "tertile") %>%
  mutate(
    high.freq = ifelse(vo1 == 1 & vo2 == 1 & vo3 == 1, 1, 0), #so1 == 1 & 
    low.freq = ifelse(vo1 == 3 & vo2 == 3 & vo3 == 3, 1, 0) #so1 == 1 & 
  )
```

45206 and 58203 were low-freqfor Mouth_hands

* Mouth_Hands_nd
```{r}
vo %>%
  filter(actobj.class == "Mouth_Hands_nd") %>%
  group_by(round) %>%
  arrange(round, desc(freq)) %>%
  mutate(
    rank = row_number(), # wow!!! That previously took me SO much code!
    tertile = cut(rank, breaks = 3, labels = c(1, 2, 3))
  ) %>%
  ungroup() %>%
  select(round, hh, tertile) %>%
  spread(key = "round", value = "tertile") %>%
  mutate(
    high.freq = ifelse(vo1 == 1 & vo2 == 1 & vo3 == 1, 1, 0),
    low.freq = ifelse(vo1 == 3 & vo2 == 3 & vo3 == 3, 1, 0)
  )
```

4801 and 26504 were low-freq for Mouth_hands_nd

```{r}
vo %>%
  filter(actobj.class == "Mouth_Fomites") %>%
  group_by(round) %>%
  arrange(round, desc(freq)) %>%
  mutate(
    rank = row_number(), # wow!!! That previously took me SO much code!
    tertile = cut(rank, breaks = 3, labels = c(1, 2, 3))
  ) %>%
  ungroup() %>%
  select(round, hh, tertile) %>%
  spread(key = "round", value = "tertile") %>%
  mutate(
    high.freq = ifelse(vo1 == 1 & vo2 == 1 & vo3 == 1, 1, 0), # so1 == 1 & 
    low.freq = ifelse(vo1 == 3 & vo2 == 3 & vo3 == 3, 1, 0) # so1 == 1 & 
  )
```


25404 was low-freq for Mouth_fomite. No children were high freq for Mouth_fomite


















# Frequency Tables


```{r}
# Info req for xtables that is the same across all the tables
rounding <- 1

addtorow <- list()
addtorow$pos <- list(0, 0, 0, 0, 0) # position
addtorow$command <- 
  c(
    "\\textbf{}               & \\multicolumn{20}{c}{\\textbf{Age group}}                      \\\\",
    "\\cmidrule(lr){2-21}",
    "\\textbf{}               
    & \\multicolumn{5}{c}{\\textbf{6-11 months}} 
    & \\multicolumn{5}{c}{\\textbf{12-23 months}} 
    & \\multicolumn{5}{c}{\\textbf{24-35 months}} 
    & \\multicolumn{5}{c}{\\textbf{36-47 months}} \\\\",
    "\\cmidrule(lr){2-6}\\cmidrule(lr){7-11}\\cmidrule(lr){12-16}\\cmidrule(lr){17-21}",
    "\\textbf{Item mouthed}   
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max}  
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max}
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max}
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max} \\\\"
  )

addtorow.mobility <- list()
addtorow.mobility$pos <- list(0, 0, 0, 0, 0) # position
addtorow.mobility$command <- 
  c(
    "\\textbf{}               & \\multicolumn{10}{c}{\\textbf{Mobility}}                      \\\\",
    "\\cmidrule(lr){2-11}",
    "\\textbf{}               
    & \\multicolumn{5}{c}{\\textbf{Crawling only}} 
    & \\multicolumn{5}{c}{\\textbf{Walking}} \\\\",
    "\\cmidrule(lr){2-6}\\cmidrule(lr){7-11}",
    "\\textbf{Item mouthed}   
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max}  
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max}
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max}
    & \\textbf{mean}  & \\textbf{sd}  & \\textbf{median} & \\textbf{min} & \\textbf{max} \\\\"
  )
```

```{r}
#################################################################
############ Frequency ######################
#################################################################

# by Age Group
freq.actobj.base <-
  vo %>%
  mutate(    
    actobj.class =
      ordered(
        actobj.class,
        levels = c(
          "Mouth_Hands",
          "Mouth_Hands_nd",
          "Mouth_Hands_d",
          "Mouth_Fomites",
          "Mouth_Utensil",
          "Mouth_Foods",
          "Mouth_Water",
          "Mouth_Soil",
          "Mouth_Feces",
          "Mouth_Animals",
          "Touch_Hands_nd",
          "Touch_Hands_d",
          "Touch_Fomites",
          "Touch_Foods",
          "Touch_Water",
          "Touch_Soil",
          "Touch_Feces",
          "Touch_Animals"
        )
      )
  ) %>%
  group_by(age.group, actobj.class) %>%
  summarise_at(vars(freq), funs(mean, sd, median, min, max), na.rm = TRUE) %>%
  mutate_if(is.numeric, funs(round(., digits = 1))) %>%
  #Clean up the names
  separate(
    actobj.class, c("act", "obj.class"),
    sep = "_",
    extra = "merge",
    fill = "right",
    remove = FALSE
  ) #%>%
# mutate(obj.class = str_to_title(obj.class))
#Plantmaterial should be PlantMaterial but not worth changing here since just a label

write.csv(freq.actobj.base, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.base.csv")  

# Mouthing
freq.actobj.class.mouth <- 
  freq.actobj.base %>%
  filter(act == "Mouth", age.group != 3) %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(age.group, data) %>%
  # separate('3', c("mean.3", "sd.3", "median.3", "min.3", "max.3"), sep = "_") %>%
  separate('4', c("mean.4", "sd.4", "median.4", "min.4", "max.4"), sep = "_") %>%
  separate('5', c("mean.5", "sd.5", "median.5", "min.5", "max.5"), sep = "_") %>%
  separate('6', c("mean.6", "sd.6", "median.6", "min.6", "max.6"), sep = "_") %>%
  separate('7', c("mean.7", "sd.7", "median.7", "min.7", "max.7"), sep = "_") %>%
  arrange(actobj.class)

write.csv(freq.actobj.class.mouth, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.csv")

freq.actobj.class.mouth.short <- 
  freq.actobj.class.mouth %>% 
  select(4:23)

# rounding <- 
#   matrix(
#     c(rep(1, (ncol(freq.actobj.class.mouth.short) + 1) * length(rnames))), 
#     nrow = length(rnames), 
#     ncol = (ncol(freq.actobj.class.mouth.short) + 1), 
#     byrow = TRUE
#     )

rnames <- 
  c("Hands, all", "Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Utensils", "Foods", "Water", "Soil", "Feces", "Animals" )
rownames(freq.actobj.class.mouth.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.mouth.short, align = "lcccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)


# Touching
freq.actobj.class.touch <- 
  freq.actobj.base %>%
  filter(act == "Touch", age.group != 3) %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(age.group, data) %>%
  #separate('3', c("mean.3", "sd.3", "median.3", "min.3", "max.3"), sep = "_") %>%
  separate('4', c("mean.4", "sd.4", "median.4", "min.4", "max.4"), sep = "_") %>%
  separate('5', c("mean.5", "sd.5", "median.5", "min.5", "max.5"), sep = "_") %>%
  separate('6', c("mean.6", "sd.6", "median.6", "min.6", "max.6"), sep = "_") %>%
  separate('7', c("mean.7", "sd.7", "median.7", "min.7", "max.7"), sep = "_")


write.csv(freq.actobj.class.touch, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.csv")

freq.actobj.class.touch.short <- 
  freq.actobj.class.touch %>% 
  select(4:23)

rnames <- 
  c("Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Foods", "Water", "Soil", "Feces", "Animals" )
rownames(freq.actobj.class.touch.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.touch.short, align = "lcccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)


```

df.vo and df.vo.obj are sep by loc - have inside and outside but not combined, so make sure to separate by LOCATION; summarizing them would be averaging averages. 

```{r}
# By Age Group and Location
df.vo.obj <-
  vo.9 %>%
  group_by(round, hh, loc, actobj) %>%
  summarise(count = n(), dur.mean = mean(dur, na.rm = TRUE)) %>%
  ungroup() %>%
  left_join(vo.awake.loc, by = c("round", "hh", "loc")) %>%
  left_join(vo.dem.long, by = c("round", "hh")) %>%
  group_by(round, hh, loc, actobj) %>%
  mutate(freq = mean(count/rec.h, na.rm = TRUE)) %>%
  rename(actobj.class = actobj) %>%
  select(
    hh,
    round,
    sex_t, 
    age.mo, 
    age.group, 
    loc, 
    actobj.class, 
    count, 
    rec.h, 
    freq, 
    dur.mean
  ) %>%
  filter(
    actobj.class 
    %in% 
      c("Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial",
        "Touch_Cloth", "Touch_Plastic", "Touch_PlantMaterial")
  ) %>%
  select(hh, round, sex_t, age.mo, age.group, loc, actobj.class, count, rec.h, freq, dur.mean)

freq.actobj.base.loc <-
  bind_rows(df.vo, df.vo.obj) %>%
  # Capitalize the names of the obj.class items 
  # (must take them apart and put them back together)
  separate(
    actobj.class, 
    c("act", "obj.class"), 
    sep = "_", 
    extra = "merge", 
    fill = "right"
  ) %>%
  mutate(obj.class = str_to_title(obj.class)) %>%
  unite(actobj.class, c("act", "obj.class"), remove = FALSE) %>%
  mutate(    
    actobj.class =
      ordered(
        actobj.class,
        levels = c(
          "Mouth_Hands",
          "Mouth_Hands_nd",
          "Mouth_Hands_d",
          "Mouth_Fomites",
          "Mouth_Utensil",
          "Mouth_Foods",
          "Mouth_Water",
          "Mouth_Soil",
          "Mouth_Feces",
          "Mouth_Animals",
          "Touch_Hands_nd",
          "Touch_Hands_d",
          "Touch_Fomites",
          "Touch_Foods",
          "Touch_Water",
          "Touch_Soil",
          "Touch_Feces",
          "Touch_Animals"
        )
      )
  ) %>%
  group_by(age.group, actobj.class, loc) %>%
  summarise_at(vars(freq), funs(mean, sd, median, min, max), na.rm = TRUE) %>%
  mutate_if(is.numeric, funs(round(., digits = 1))) %>%
  #Clean up the names
  separate(
    actobj.class, c("act", "obj.class"),
    sep = "_",
    extra = "merge",
    fill = "right",
    remove = FALSE
  ) #%>%
# mutate(obj.class = str_to_title(obj.class))
#Plantmaterial should be PlantMaterial but not worth changing here since just a label

write.csv(freq.actobj.base.loc, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.base.loc.csv")  

## Mouthing and Inside

freq.actobj.class.mouth.loc.inside <- 
  freq.actobj.base.loc %>%
  filter(act == "Mouth", loc == "Inside", age.group != 3) %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(age.group, data) %>%
  #separate('3', c("mean.3", "sd.3", "median.3", "min.3", "max.3"), sep = "_") %>%
  separate('4', c("mean.4", "sd.4", "median.4", "min.4", "max.4"), sep = "_") %>%
  separate('5', c("mean.5", "sd.5", "median.5", "min.5", "max.5"), sep = "_") %>%
  separate('6', c("mean.6", "sd.6", "median.6", "min.6", "max.6"), sep = "_") %>%
  separate('7', c("mean.7", "sd.7", "median.7", "min.7", "max.7"), sep = "_") 

write.csv(freq.actobj.class.mouth.loc.inside, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.loc.inside.csv")

freq.actobj.class.mouth.loc.inside.short <- 
  freq.actobj.class.mouth.loc.inside %>% 
  ungroup() %>%
  select(5:24) #%>%
#rbind(., c(rep(NA, 20)))

# There was no mouthing of animals indoors. Right now can't figure out 
rnames <- 
  c("Hands, all", "Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Utensils", "Foods", "Water", "Soil", "Feces") # , "Animals" 
rownames(freq.actobj.class.mouth.loc.inside.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.mouth.loc.inside.short, align = "lcccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.inside.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)

## Mouthing and Outside

freq.actobj.class.mouth.loc.outside <- 
  freq.actobj.base.loc %>%
  filter(act == "Mouth", loc == "Outside", age.group != 3) %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(age.group, data) %>%
  #separate('3', c("mean.3", "sd.3", "median.3", "min.3", "max.3"), sep = "_") %>%
  separate('4', c("mean.4", "sd.4", "median.4", "min.4", "max.4"), sep = "_") %>%
  separate('5', c("mean.5", "sd.5", "median.5", "min.5", "max.5"), sep = "_") %>%
  separate('6', c("mean.6", "sd.6", "median.6", "min.6", "max.6"), sep = "_") %>%
  separate('7', c("mean.7", "sd.7", "median.7", "min.7", "max.7"), sep = "_") # %>%
# rbind(c(actobj.class = as.factor("Mouth_Feces"), act = "Mouth", obj.class = "Feces", loc = "Outside", rep(NA, 20))) %>%
# # mutate(    
# #   actobj.class =
# #     ordered(
# #       actobj.class,
# #       levels = c(
# #         "Mouth_Hands",
# #         "Mouth_Hands_nd",
# #         "Mouth_Hands_d",
# #         "Mouth_Fomites",
# #         "Mouth_Utensil",
# #         "Mouth_Foods",
# #         "Mouth_Water",
# #         "Mouth_Soil",
# #         "Mouth_Feces",
# #         "Mouth_Animals",
# #         "Touch_Hands_nd",
# #         "Touch_Hands_d",
# #         "Touch_Fomites",
# #         "Touch_Foods",
# #         "Touch_Water",
# #         "Touch_Soil",
# #         "Touch_Feces",
# #         "Touch_Animals"
# #       )
# #     )
# # ) %>%
# arrange(actobj.class)

write.csv(freq.actobj.class.mouth.loc.outside, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.loc.outside.csv")

freq.actobj.class.mouth.loc.outside.short <- 
  freq.actobj.class.mouth.loc.outside %>% 
  ungroup() %>%
  select(5:24) # %>%
# rbind(., c(rep(NA, 20)))

# There was no mouthing of feces outdoors

rnames <- 
  c("Hands, all", "Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Utensils", "Foods", "Water", "Soil",  "Animals" ) # "Feces",
rownames(freq.actobj.class.mouth.loc.outside.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.mouth.loc.outside.short, align = "lcccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.outside.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)


## Touching & Inside

freq.actobj.class.touch.loc.inside <- 
  freq.actobj.base.loc %>%
  filter(act == "Touch", loc == "Inside", age.group != 3) %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(age.group, data) %>%
  #separate('3', c("mean.3", "sd.3", "median.3", "min.3", "max.3"), sep = "_") %>%
  separate('4', c("mean.4", "sd.4", "median.4", "min.4", "max.4"), sep = "_") %>%
  separate('5', c("mean.5", "sd.5", "median.5", "min.5", "max.5"), sep = "_") %>%
  separate('6', c("mean.6", "sd.6", "median.6", "min.6", "max.6"), sep = "_") %>%
  separate('7', c("mean.7", "sd.7", "median.7", "min.7", "max.7"), sep = "_")

write.csv(freq.actobj.class.touch.loc.inside, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.loc.inside.csv")

freq.actobj.class.touch.loc.inside.short <- 
  freq.actobj.class.touch.loc.inside %>%
  ungroup() %>%
  select(5:24)

rnames <- 
  c("Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Foods", "Water", "Soil", "Feces", "Animals" )
rownames(freq.actobj.class.touch.loc.inside.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.touch.loc.inside.short, align = "lcccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.inside.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)

## Touching & Outside

freq.actobj.class.touch.loc.outside <- 
  freq.actobj.base.loc %>%
  filter(act == "Touch", loc == "Outside", age.group != 3) %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(age.group, data) %>%
  #separate('3', c("mean.3", "sd.3", "median.3", "min.3", "max.3"), sep = "_") %>%
  separate('4', c("mean.4", "sd.4", "median.4", "min.4", "max.4"), sep = "_") %>%
  separate('5', c("mean.5", "sd.5", "median.5", "min.5", "max.5"), sep = "_") %>%
  separate('6', c("mean.6", "sd.6", "median.6", "min.6", "max.6"), sep = "_") %>%
  separate('7', c("mean.7", "sd.7", "median.7", "min.7", "max.7"), sep = "_")

write.csv(freq.actobj.class.touch.loc.outside, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.loc.outside.csv")

freq.actobj.class.touch.loc.outside.short <- 
  freq.actobj.class.touch.loc.outside %>% 
  ungroup() %>%
  select(5:24)

rnames <- 
  c("Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Foods", "Water", "Soil", "Feces", "Animals" )
rownames(freq.actobj.class.touch.loc.outside.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.touch.loc.outside.short, align = "lcccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.outside.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)
```

```{r}
# By Mobility

freq.actobj.mobility.base <-
  vo %>%
  mutate(    
    actobj.class =
      ordered(
        actobj.class,
        levels = c(
          "Mouth_Hands",
          "Mouth_Hands_nd",
          "Mouth_Hands_d",
          "Mouth_Water",
          "Mouth_Fomites",
          "Mouth_Utensil",
          "Mouth_Foods",
          "Mouth_Soil",
          "Mouth_Feces",
          "Mouth_Animals",
          "Touch_Hands_nd",
          "Touch_Hands_d",
          "Touch_Water",
          "Touch_Fomites",
          "Touch_Foods",
          "Touch_Soil",
          "Touch_Feces",
          "Touch_Animals"
        )
      )
  ) %>%
  group_by(mobility, actobj.class) %>%
  summarise_at(vars(freq), funs(mean, sd, median, min, max), na.rm = TRUE) %>%
  mutate_if(is.numeric, funs(round(., digits = 1))) %>%
  #Clean up the names
  separate(
    actobj.class, c("act", "obj.class"),
    sep = "_",
    extra = "merge",
    fill = "right",
    remove = FALSE
  ) #%>%
# mutate(obj.class = str_to_title(obj.class))
#Plantmaterial should be PlantMaterial but not worth changing here since just a label

write.csv(freq.actobj.mobility.base, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.mobility.base.csv")  

# Mouthing
freq.actobj.class.mouth.mobility <- 
  freq.actobj.mobility.base %>%
  filter(act == "Mouth") %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(mobility, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(mobility, data) %>%
  separate('1', c("mean.crawl", "sd.crawl", "median.crawl", "min.crawl", "max.crawl"), sep = "_") %>%
  separate('2', c("mean.walk", "sd.walk", "median.walk", "min.walk", "max.walk"), sep = "_") %>%
  arrange(actobj.class)

write.csv(freq.actobj.class.mouth.mobility, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.mobility.csv")

freq.actobj.class.mouth.mobility.short <- 
  freq.actobj.class.mouth.mobility %>% 
  ungroup() %>%
  select(4:13)

rnames <- 
  c("Hands, all", "Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Utensils", "Foods", "Water", "Soil", "Feces", "Animals" )
rownames(freq.actobj.class.mouth.mobility.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.mouth.mobility.short, align = "lcccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.mouth.mobility.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow.mobility, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)

# Touching
freq.actobj.class.touch.mobility <- 
  freq.actobj.mobility.base %>%
  filter(act == "Touch") %>%
  # unite(actobj.class, act, obj.class) %>%
  arrange(mobility, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, mean, sd, median, min, max) %>%
  spread(mobility, data) %>%
  separate('1', c("mean.crawl", "sd.crawl", "median.crawl", "min.crawl", "max.crawl"), sep = "_") %>%
  separate('2', c("mean.walk", "sd.walk", "median.walk", "min.walk", "max.walk"), sep = "_") %>%
  arrange(actobj.class)

write.csv(freq.actobj.class.touch.mobility, "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.mobility.csv")

freq.actobj.class.touch.mobility.short <- 
  freq.actobj.class.touch.mobility %>% 
  select(4:13)

rnames <- 
  c("Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Foods", "Water", "Soil", "Feces", "Animals" )
rownames(freq.actobj.class.touch.mobility.short) <- rnames

sum.stats.table <- xtable(freq.actobj.class.touch.mobility.short, align = "lcccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/freq.actobj.class.touch.mobility.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = T, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)
```



# Duration Tables

```{r}
#################################################################
############ Duration ######################
#################################################################

dur.actobj.base <- 
  vo.9 %>%
  # mutate(    
  #   actobj.class =
  #     ordered(
  #       actobj.class,
  #       levels = c(
  #         "Mouth_Hands",
  #         "Mouth_Hands_nd",
  #         "Mouth_Hands_d",
  #         "Mouth_Water",
  #         "Mouth_Fomites",
  #         "Mouth_Utensil",
#         "Mouth_Foods",
#         "Mouth_Soil",
#         "Mouth_Feces",
#         "Mouth_Animals",
#         "Touch_Hands_nd",
#         "Touch_Hands_d",
#         "Touch_Water",
#         "Touch_Fomites",
#         "Touch_Foods",
#         "Touch_Soil",
#         "Touch_Feces",
#         "Touch_Animals"
#       )
#     )
# ) %>%
group_by(age.group, actobj.class) %>%
  filter(obj %notin% c("NotInView", "Nothing")) %>%
  # vo.9.long.loc[vo.9.long.loc$actobj == " Touch_PlantMaterial",] # There is only one observation where the actobj is miscoded cuz it has a space: 49503 2013    R     n     timestamp = 131.0798; just remove this and don't worry about it. 
  filter(actobj != " Touch_PlantMaterial") %>%
  summarize(
    dur.mean = mean(dur, na.rm = TRUE), 
    dur.sd = sd(dur, na.rm = TRUE), 
    dur.median = median(dur, na.rm = TRUE)
  ) %>%
  mutate_if(is.numeric, funs(round(., digits = 1))) %>%
  arrange(age.group, actobj.class)
write.csv(dur.actobj.base, "C:/Users/lenovo/Box Sync/VO R123/dur.actobj.base.csv")

# Mouth and Touch_cloth, plastic, plant material + allobj.class


## Mouthing Duration

dur.actobj.class.mouth.base.full <-
  vo.9 %>%
  filter(act == "Mouth", obj %notin% c("NotInView", "Nothing")) %>%
  group_by(age.group, actobj.class) %>%
  summarize(
    dur.mean = round(mean(dur, na.rm = TRUE), 1), 
    dur.sd = round(sd(dur, na.rm = TRUE), 1), 
    dur.median = round(median(dur, na.rm = TRUE), 1), 
    min = round(min(dur), 1), 
    max = round(max(dur), 1)
  ) %>%
  mutate_if(is.numeric, funs(round(., digits = 1)))

# dur.actobj.class.mouth.summary.full <- 
#   dur.actobj.class.mouth.base.full %>%
#   ungroup() %>%
#   group_by(age.group, actobj.class) %>%
#   summarize(
#     #count = n(), 
#     dur.mean = round(mean(dur.mean.hh, na.rm = TRUE), 1) , 
#     dur.sd = round(sd(dur.mean.hh, na.rm = TRUE), 1), 
#     dur.median = round(median(dur.mean.hh, na.rm = TRUE), 1),
#     min = round(min(dur.mean.hh),1), max = round(max(dur.mean.hh), 1)
#   ) %>%
#    mutate_if(is.numeric, funs(round(., digits = 1)))
# 
# dur.actobj.mouth.base <- 
#   vo.9 %>%
#   filter(act == "Mouth", obj %in% c("Cloth", "Plastic", "PlantMaterial")) %>%
#   group_by(hh, age.group, actobj) %>%
#   summarize(
#     #count = n(), 
#     dur.mean.hh = round(mean(dur, na.rm = TRUE), 1) 
#     #, dur.sd = round(sd(dur, na.rm = TRUE),1), dur.median = round(median(dur, na.rm = TRUE),1), min = round(min(dur),1), max = round(max(dur),1)
#   ) %>%
#    mutate_if(is.numeric, funs(round(., digits = 1))) %>%
#   setNames(c("hh", "age.group", "actobj.class", "dur.mean.hh")) # "count",
# 
# dur.actobj.mouth.summary <- 
#   dur.actobj.mouth.base %>%
#   ungroup() %>%
#   group_by(age.group, actobj.class) %>%
#   summarize(
#     #count = n(), 
#     dur.mean = round(mean(dur.mean, na.rm = TRUE), 1) , 
#     dur.sd = round(sd(dur.mean, na.rm = TRUE),1), 
#     dur.median = round(median(dur.mean, na.rm = TRUE),1),
#     min = round(min(dur.mean),1), max = round(max(dur.mean),1)
#     # dur.mean = round(mean(dur.mean.hh, na.rm = TRUE), 1) , 
#     # dur.sd = round(sd(dur.mean.hh, na.rm = TRUE),1), 
#     # dur.median = round(median(dur.mean.hh, na.rm = TRUE),1),
#     # min = round(min(dur.mean.hh),1), max = round(max(dur.mean.hh),1)
#   ) %>%
#   mutate_if(is.numeric, funs(round(., digits = 1)))
# 
# dur.actobj.class.mouth.hh <- 
#   bind_rows(dur.actobj.class.mouth.base, dur.actobj.mouth.base) %>%
#   mutate(actobj.class = as.factor(actobj.class))

dur.actobj.class.mouth.hh <- 
  # bind_rows(dur.actobj.class.mouth.summary, dur.actobj.mouth.summary) %>%
  dur.actobj.class.mouth.base.full %>%
  filter(age.group != 3) %>%
  arrange(age.group, actobj.class) %>% # = c("Mouth_nd", "Mouth_d", "Mouth_fomite", "Mouth_Cloth", "Mouth_Plastic", "Mouth_PlantMaterial", "Mouth_soil", "Mouth_feces", "Mouth_food", "Mouth_water", "Mouth_animals")) %>%
  unite(data, dur.mean, dur.sd, dur.median, min, max) %>% # count,
  spread(age.group, data) %>%
  # separate('3', c("dur.mean.3", "dur.sd.3", "dur.median.3", "min.3", "max.3"), sep = "_") %>% # "count.3", 
  separate('4', c("dur.mean.4", "dur.sd.4", "dur.median.4", "min.4", "max.4"), sep = "_") %>% # "count.4", 
  separate('5', c("dur.mean.5", "dur.sd.5", "dur.median.5", "min.5", "max.5"), sep = "_") %>% # "count.5", 
  separate('6', c("dur.mean.6", "dur.sd.6", "dur.median.6", "min.6", "max.6"), sep = "_") %>% # "count.6",
  separate('7', c("dur.mean.7", "dur.sd.7", "dur.median.7", "min.7", "max.7"), sep = "_") # "count.7", 

write.csv(dur.actobj.class.mouth.hh, "C:/Users/lenovo/Box Sync/VO R123/dur.actobj.class.mouth.hh.csv")

dur.actobj.class.mouth.hh.short <- 
  dur.actobj.class.mouth.hh %>% 
  ungroup()  %>%
  select(1:21)

# rnames <- 
#   c("Hands, all", "Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Utensils", "Foods", "Water", "Soil", "Feces", "Animals" )
# rownames(dur.actobj.class.mouth.hh.short) <- rnames

sum.stats.table <- xtable(dur.actobj.class.mouth.hh.short, align = "lccccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/dur.actobj.class.mouth.hh.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = F, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)

## Touching Duration

dur.actobj.class.touch.base.full <- 
  vo.9 %>%
  filter(act == "Touch", obj %notin% c("NotInView", "Nothing")) %>%
  group_by(age.group, actobj.class) %>%
  summarize(
    dur.mean = round(mean(dur, na.rm = TRUE), 1), 
    dur.sd = round(sd(dur, na.rm = TRUE), 1), 
    dur.median = round(median(dur, na.rm = TRUE), 1), 
    min = round(min(dur), 1), 
    max = round(max(dur), 1)
  ) %>%
  mutate_if(is.numeric, funs(round(., digits = 1)))
# # Keep Touch_hands_d and Touch_hands_nd separate
# mutate(
#   ifelse(
#     actobj.class %in% c("Touch_hands_d", "Touch_hands_nd"), "Touch_Hands", actobj.class
#   )
# )

# dur.actobj.class.touch.summary.full <- 
#   dur.actobj.class.touch.base.full %>%
#   ungroup() %>%
#   group_by(age.group, actobj.class) %>%
#   summarize(
#     # count = n(), 
#     dur.mean = round(mean(dur.mean.hh, na.rm = TRUE), 1) , 
#     dur.sd = round(sd(dur.mean.hh, na.rm = TRUE), 1), 
#     dur.median = round(median(dur.mean.hh, na.rm = TRUE), 1),
#     min = round(min(dur.mean.hh),1), max = round(max(dur.mean.hh), 1)
#   ) %>%
#   mutate_if(is.numeric, funs(round(., digits = 1)))
# 
# dur.actobj.touch.base <- 
#   vo.9 %>%
#   filter(act == "Touch", obj %in% c("Cloth", "Plastic", "PlantMaterial")) %>%
#   group_by(hh, age.group, actobj) %>%
#   summarize(
#     # count = n(), 
#     dur.mean.hh = round(mean(dur, na.rm = TRUE), 1) 
#     #, dur.sd = round(sd(dur, na.rm = TRUE),1), dur.median = round(median(dur, na.rm = TRUE),1), min = round(min(dur),1), max = round(max(dur),1)
#   ) %>%
#    mutate_if(is.numeric, funs(round(., digits = 1))) %>%
#   setNames(c("hh", "age.group", "actobj.class", "dur.mean.hh")) # "count",
# 
# dur.actobj.touch.summary <- 
#   dur.actobj.touch.base %>%
#   ungroup() %>%
#   group_by(age.group, actobj.class) %>%
#   summarize(
#     #count = n(), 
#     dur.mean = round(mean(dur.mean, na.rm = TRUE), 1) , 
#     dur.sd = round(sd(dur.mean, na.rm = TRUE),1), 
#     dur.median = round(median(dur.mean, na.rm = TRUE),1),
#     min = round(min(dur.mean),1), max = round(max(dur.mean),1)
#     # dur.mean = round(mean(dur.mean.hh, na.rm = TRUE), 1) , 
#     # dur.sd = round(sd(dur.mean.hh, na.rm = TRUE),1), 
#     # dur.median = round(median(dur.mean.hh, na.rm = TRUE),1),
#     # min = round(min(dur.mean.hh),1), max = round(max(dur.mean.hh),1)
#   ) %>%
#   mutate_if(is.numeric, funs(round(., digits = 1)))
# 
# dur.actobj.class.touch.hh <- bind_rows(dur.actobj.class.touch.base, dur.actobj.touch.base)

dur.actobj.class.touch.hh <- 
  # bind_rows(dur.actobj.class.touch.summary, dur.actobj.touch.summary) %>%
  dur.actobj.class.touch.base.full %>%
  filter(age.group != 3) %>%
  arrange(age.group, actobj.class) %>%
  unite(data, dur.mean, dur.sd, dur.median, min, max) %>% # count,
  spread(age.group, data) %>%
  #separate('3', c("dur.mean.3", "dur.sd.3", "dur.median.3", "min.3", "max.3"), sep = "_") %>% # "count.3", 
  separate('4', c("dur.mean.4", "dur.sd.4", "dur.median.4", "min.4", "max.4"), sep = "_") %>% # "count.4", 
  separate('5', c("dur.mean.5", "dur.sd.5", "dur.median.5", "min.5", "max.5"), sep = "_") %>% # "count.5", 
  separate('6', c("dur.mean.6", "dur.sd.6", "dur.median.6", "min.6", "max.6"), sep = "_") %>% # "count.6",
  separate('7', c("dur.mean.7", "dur.sd.7", "dur.median.7", "min.7", "max.7"), sep = "_") # "count.7",

write.csv(dur.actobj.class.touch.hh, "C:/Users/lenovo/Box Sync/VO R123/dur.actobj.class.touch.hh.csv")

dur.actobj.class.touch.hh.short <- 
  dur.actobj.class.touch.hh %>% 
  select(1:21)

# rnames <- 
#   c("Hands,\nnot while eating", "Hands, \nwhile eating", "Objects", "Foods", "Water", "Soil", "Feces", "Animals" )
# rownames(dur.actobj.class.touch.hh.short) <- rnames

sum.stats.table <- xtable(dur.actobj.class.touch.hh.short, align = "lccccccccccccccccccccc", digits = rounding)
label(sum.stats.table) <- "table:sum_stats"

print(
  sum.stats.table, 
  file = "C:/Users/lenovo/Box Sync/VO R123/dur.actobj.class.touch.hh.tex", #paste(tables, "mcp_t1.tex", sep = ""), 
  type = "latex", 
  caption.placement = "top", 
  floating = F, # floating = false is to remove the table wrapping environment from the export because I use threeparttable to add tables to LaTeX, but if you want the table environment, change this back to "TRUE"
  add.to.row = addtorow, # adds the multicolumn row headers I created above with the addtorow$command line
  include.colnames = F, #false because I want to use the custom headers in addtorow instead 
  include.rownames = F, 
  booktabs = T, #i always use the booktabs LaTeX package which replaces \hlines with \toprule, \midrule and \bottomrule and I think looks nicer, but you need to make sure to add booktabs to your latex preamble to use this
  hline.after = c(-1,-1, 0, 1:nrow(sum.stats.table), nrow(sum.stats.table)), #this just added extra horizontal lines because Grant wanted double lines on the top and bottom
  format.args = list(big.mark = ",") #adds commas for formatting large numbers
)
```

# Difference in soil consumption in SO and VO

## children 6-12 mo old
```{r}
prop.test(x = c(8, 29), n = c(19, 104)) # p = 0.3316
```

## children 12-24 mo old
```{r}
prop.test(x = c(8, 8), n = c(31, 23)) # p = 0.67966
```


